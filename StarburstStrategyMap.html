<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>专 砖转驻 住专 | Starburst</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Markdown Parser for AI responses -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;700;900&display=swap');
        body { font-family: 'Heebo', sans-serif; background-color: #F1F1F1; }
        
        /* Custom Scrollbar - YELLOW THEME */
        ::-webkit-scrollbar { width: 10px; height: 10px; }
        ::-webkit-scrollbar-track { background: #F1F1F1; }
        ::-webkit-scrollbar-thumb { background: #FFC700; border-radius: 5px; border: 2px solid #F1F1F1; }
        ::-webkit-scrollbar-thumb:hover { background: #E5B300; }

        /* Hide Scrollbar for Horizontal List but allow functionality */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* Cursor styles for dragging */
        .cursor-grab { cursor: grab; }
        .cursor-grabbing { cursor: grabbing; }

        .animate-spin { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        
        /* Slow Spin for Background */
        @keyframes spin-slow {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .animate-spin-slow {
            animation: spin-slow 60s linear infinite;
        }

        /* Toast Animation */
        @keyframes slideIn {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .toast-enter { animation: slideIn 0.3s ease-out forwards; }
        
        /* Footer Animation */
        .footer-slide-up { transition: transform 0.3s ease-in-out; }
        .footer-hidden { transform: translateY(100%); }
        .footer-visible { transform: translateY(0); }

        /* Mobile Grid Fixes */
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        /* Fade In Animation */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fadeIn {
            animation: fadeIn 0.2s ease-out forwards;
        }

        /* Markdown Styles within AI Modal */
        .prose h3 { font-weight: 800; margin-top: 1rem; margin-bottom: 0.5rem; color: #1F2937; }
        .prose p { margin-bottom: 0.8rem; line-height: 1.6; }
        .prose ul { list-style-type: disc; padding-right: 1.5rem; margin-bottom: 1rem; }
        .prose strong { color: #CA8A04; font-weight: 700; }
    </style>
</head>
<body class="relative overflow-x-hidden">
    <!-- Static Background Image -->
    <div class="fixed inset-0 z-0 flex items-center justify-center pointer-events-none overflow-hidden">
        <img src="./INNOVET_LOGO_HOR_NEG-02-2.svg" alt="" class="w-full h-full object-cover opacity-5" />
    </div>

    <div id="root" class="relative z-10"></div>

    <script type="text/babel" data-type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, doc, setDoc, updateDoc, deleteDoc, onSnapshot, serverTimestamp, query, orderBy, writeBatch } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const React = window.React;
        const { useState, useEffect, useMemo, useRef } = React;

        // --- Firebase Configuration ---
        const firebaseConfig = {
            apiKey: "AIzaSyDkEOW4aXGmuO_J-X5xJTw9Iyp0Q2pbUIY",
            authDomain: "psychoflash-control.firebaseapp.com",
            projectId: "psychoflash-control",
            storageBucket: "psychoflash-control.firebasestorage.app",
            messagingSenderId: "304053769812",
            appId: "1:304053769812:web:3b55fb16bbbda06b993fc1"
        };

        // Initialize Firebase
        let app, auth, db;
        const appId = 'starburst-partners';

        try {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
        } catch (e) {
            console.error("Failed to initialize Firebase:", e);
        }

        // --- Custom Hooks ---
        const useDraggableScroll = (ref) => {
            useEffect(() => {
                const el = ref.current;
                if (!el) return;

                let isDown = false;
                let startX;
                let scrollLeft;

                const onMouseDown = (e) => {
                    if (e.button !== 0) return;
                    isDown = true;
                    el.classList.add('cursor-grabbing');
                    el.classList.remove('cursor-grab');
                    startX = e.pageX - el.offsetLeft;
                    scrollLeft = el.scrollLeft;
                };

                const onMouseLeave = () => {
                    isDown = false;
                    el.classList.remove('cursor-grabbing');
                    el.classList.add('cursor-grab');
                };

                const onMouseUp = () => {
                    isDown = false;
                    el.classList.remove('cursor-grabbing');
                    el.classList.add('cursor-grab');
                };

                const onMouseMove = (e) => {
                    if (!isDown) return;
                    e.preventDefault();
                    const x = e.pageX - el.offsetLeft;
                    const walk = (x - startX) * 1.5;
                    el.scrollLeft = scrollLeft - walk;
                };

                el.classList.add('cursor-grab');
                el.addEventListener('mousedown', onMouseDown);
                el.addEventListener('mouseleave', onMouseLeave);
                el.addEventListener('mouseup', onMouseUp);
                el.addEventListener('mousemove', onMouseMove);

                return () => {
                    el.removeEventListener('mousedown', onMouseDown);
                    el.removeEventListener('mouseleave', onMouseLeave);
                    el.removeEventListener('mouseup', onMouseUp);
                    el.removeEventListener('mousemove', onMouseMove);
                };
            }, [ref]);
        };

        // --- Icons ---
        const Icons = {
            Search: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>,
            Filter: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon></svg>,
            Phone: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg>,
            Mail: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>,
            MessageCircle: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path></svg>,
            MapPin: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>,
            Lightbulb: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="9" y1="18" x2="15" y2="18"></line><line x1="10" y1="22" x2="14" y2="22"></line><path d="M15.09 14c.18-.98.65-1.74 1.41-2.5A4.65 4.65 0 0 0 16 8c0-4.42-3.58-8-8-8s-8 3.58-8 8c0 2.08.73 3.97 1.92 5.48.1.13.2.25.3.37.66.77 1.12 1.53 1.28 2.5H15.09z"></path></svg>,
            Rocket: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z"></path><path d="M12 15l-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z"></path><path d="M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0"></path><path d="M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5"></path></svg>,
            Edit3: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M12 20h9"></path><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path></svg>,
            Trash2: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>,
            Plus: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>,
            Save: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg>,
            X: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>,
            RefreshCw: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg>,
            Check: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="20 6 9 17 4 12"></polyline></svg>,
            UploadCloud: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242"/><path d="M12 12v9"/><path d="m16 16-4-4-4 4"/></svg>,
            Zap: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>,
            Grid: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>,
            Layout: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="3" y1="9" x2="21" y2="9"></line><line x1="9" y1="21" x2="9" y2="9"></line></svg>,
            Sparkles: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M9 5H5"/><path d="M19 19v2"/><path d="M21 21h-2"/></svg>,
            Copy: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>,
            Send: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>,
            Bot: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect x="3" y="11" width="18" height="10" rx="2"></rect><circle cx="12" cy="5" r="2"></circle><path d="M12 7v4"></path><line x1="8" y1="16" x2="8" y2="16"></line><line x1="16" y1="16" x2="16" y2="16"></line></svg>,
            Key: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"></path></svg>,
            AlertTriangle: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
        };

        const THEME = {
            black: '#191B1D',
            dark: '#17191A',
            yellow: '#FFC700',
            blue: '#1F63C7',
            bg: '#F1F1F1',
            gray: '#E3E3E3',
            white: '#FFFFFF'
        };

        // --- CSV Parser ---
        const parseCSV = (str) => {
            const arr = [];
            let quote = false;
            for (let row = 0, col = 0, c = 0; c < str.length; c++) {
                let cc = str[c], nc = str[c+1];
                arr[row] = arr[row] || [];
                arr[row][col] = arr[row][col] || '';
                if (cc == '"' && quote && nc == '"') { arr[row][col] += cc; ++c; continue; }
                if (cc == '"') { quote = !quote; continue; }
                if (cc == ',' && !quote) { ++col; continue; }
                if (cc == '\r' && nc == '\n' && !quote) { ++row; col = 0; ++c; continue; }
                if (cc == '\n' && !quote) { ++row; col = 0; continue; }
                if (cc == '\r' && !quote) { ++row; col = 0; continue; }
                arr[row][col] += cc;
            }
            return arr;
        };

        // --- Components ---
        const Toast = ({ type, message, onClose }) => {
            if (!message) return null;
            return (
                <div className={`fixed bottom-20 left-4 z-50 px-6 py-4 rounded-lg shadow-xl flex items-center gap-3 toast-enter transform transition-all duration-300 ${type === 'success' ? 'bg-[#191B1D] text-white border-r-4 border-[#FFC700]' : 'bg-red-600 text-white border-r-4 border-white'}`}>
                    {type === 'success' ? <Icons.Check size={20} className="text-[#FFC700]" /> : <Icons.AlertTriangle size={20} />}
                    <span className="font-bold text-sm">{message}</span>
                    <button onClick={onClose} className="mr-4 text-white/50 hover:text-white"><Icons.X size={16} /></button>
                </div>
            );
        };

        const ActionButton = ({ href, onClick, icon: Icon, label, colorClass, className="" }) => {
            if (href) {
                return (
                    <a href={href} target={href.startsWith('http') ? "_blank" : undefined} className={`flex items-center justify-center gap-2 py-2 px-4 rounded font-bold text-sm transition-all duration-200 flex-1 shadow-sm cursor-pointer ${colorClass} ${className}`}>
                        <Icon size={16} /> <span>{label}</span>
                    </a>
                );
            }
            return (
                <button onClick={onClick} className={`flex items-center justify-center gap-2 py-2 px-4 rounded font-bold text-sm transition-all duration-200 flex-1 shadow-sm cursor-pointer ${colorClass} ${className}`}>
                    <Icon size={16} /> <span>{label}</span>
                </button>
            );
        };

        // --- Main App ---
        const App = () => {
            // ---  HARDCODED API KEY (Optional)  ---
            // Paste your key inside the quotes below to auto-load it.
            const HARDCODED_API_KEY = "PASTE_YOUR_KEY_HERE"; 

            const [partners, setPartners] = useState([]);
            const [loading, setLoading] = useState(true);
            const [user, setUser] = useState(null);
            const [searchTerm, setSearchTerm] = useState("");
            const [selectedCategory, setSelectedCategory] = useState("");
            const [filterStatus, setFilterStatus] = useState("all"); 
            const [filterSubCategory, setFilterSubCategory] = useState("all");
            
            const [layoutMode, setLayoutMode] = useState(window.innerWidth < 768 ? 'compact' : 'detailed');

            const [editingId, setEditingId] = useState(null);
            const [viewingId, setViewingId] = useState(null);
            
            // AI Mock State
            const [showAIModal, setShowAIModal] = useState(false);
            const [aiPartner, setAiPartner] = useState(null);
            const [aiContentType, setAiContentType] = useState('pitch'); 
            const [aiContentResult, setAiContentResult] = useState("");
            const [isGeneratingAI, setIsGeneratingAI] = useState(false);
            const [customPrompt, setCustomPrompt] = useState("");
            const [aiMenuOpenId, setAiMenuOpenId] = useState(null);
            
            // AI Key State (Initialize with Hardcoded key or LocalStorage)
            const [apiKey, setApiKey] = useState(HARDCODED_API_KEY || localStorage.getItem('gemini_api_key') || "");
            const [showKeyInput, setShowKeyInput] = useState(false);

            const [editForm, setEditForm] = useState({});
            const [isAddingNew, setIsAddingNew] = useState(false);
            const [isImportModalOpen, setIsImportModalOpen] = useState(false);
            const [importUrl, setImportUrl] = useState("https://docs.google.com/spreadsheets/d/e/2PACX-1vQSkgkIvL4h1048RW_HiR-qnodnGw_XoVJZ9x_6sdgkMdTg9FN4ggtcW681YwM2jGSj8YoBAKxFP7Gw/pub?output=csv");
            const [notification, setNotification] = useState(null);
            const [showBottomBar, setShowBottomBar] = useState(false);

            const categoryListRef = useRef(null);
            useDraggableScroll(categoryListRef);

            const activePartner = useMemo(() => partners.find(p => p.id === viewingId), [partners, viewingId]);

            const showNotification = (type, message) => {
                setNotification({ type, message });
                setTimeout(() => setNotification(null), 3500);
            };

            useEffect(() => {
                const handleScroll = () => setShowBottomBar(window.scrollY > 250);
                window.addEventListener('scroll', handleScroll);
                return () => window.removeEventListener('scroll', handleScroll);
            }, []);

            useEffect(() => {
                const initAuth = async () => {
                    try {
                        await signInAnonymously(auth);
                    } catch (e) {
                        console.error("Auth failed", e);
                        setLoading(false);
                    }
                };
                initAuth();
                return onAuthStateChanged(auth, (u) => setUser(u));
            }, []);

            useEffect(() => {
                if (!user) return;
                const q = collection(db, 'artifacts', appId, 'public', 'data', 'partners');
                const unsubscribe = onSnapshot(q, (snapshot) => {
                    let docs = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    docs.sort((a, b) => (a.company || "").localeCompare(b.company || ""));
                    setPartners(docs);
                    setLoading(false);
                }, (err) => {
                    console.error("Sync error", err);
                    setLoading(false);
                });
                return () => unsubscribe();
            }, [user]);

            const toggleContact = async (partner) => {
                if (!user) return;
                try {
                    const ref = doc(db, 'artifacts', appId, 'public', 'data', 'partners', partner.id);
                    await updateDoc(ref, { contacted: !partner.contacted });
                    showNotification('success', partner.contacted ? '住住 注:  爪专 拽砖专' : '住住 注: 爪专 拽砖专');
                } catch(e) { console.error(e); showNotification('error', '砖 注'); }
            };

            const handleDelete = async (id) => {
                if (!user) return;
                if (!window.confirm(" 拽 砖转祝  爪转转?")) return;
                try {
                    if (!id) throw new Error("Invalid ID");
                    await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'partners', id));
                    setViewingId(null);
                    setEditingId(null);
                    showNotification('success', '砖转祝 拽 爪');
                } catch (e) {
                    console.error("Delete failed:", e);
                    showNotification('error', '砖 拽');
                }
            };

            const handleSave = async () => {
                if (!user) return;
                const colRef = collection(db, 'artifacts', appId, 'public', 'data', 'partners');
                const data = { ...editForm };
                try {
                    if (isAddingNew) {
                        await setDoc(doc(colRef), { ...data, contacted: false, note: "", createdAt: serverTimestamp() });
                        showNotification('success', '砖转祝 砖 住祝 爪');
                    } else {
                        await updateDoc(doc(colRef, editingId), data);
                        showNotification('success', '驻专 砖专 爪');
                    }
                    setEditingId(null);
                    setEditForm({});
                    setIsAddingNew(false);
                } catch(e) {
                    console.error("Save failed:", e);
                    showNotification('error', '砖 砖专');
                }
            };

            const saveNote = async (id, text) => {
                if (!user) return;
                try {
                    await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'partners', id), { note: text });
                } catch(e) { console.error(e); }
            };
            
            // Function to save AI insights
            const saveAiToPartner = async (partnerId, content) => {
                if (!user) return;
                try {
                    await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'partners', partnerId), { 
                        aiAnalysis: content 
                    });
                    showNotification('success', '转 砖专 专住 砖转祝');
                } catch(e) { 
                    console.error(e); 
                    showNotification('error', '砖 砖专');
                }
            };

            const updateNoteLocalUI = (id, text) => {
                 setPartners(prev => prev.map(p => p.id === id ? { ...p, note: text } : p));
            };

            const handleImport = async () => {
                if (!user) return;
                setLoading(true);
                try {
                    const proxyUrl = "https://api.allorigins.win/raw?url=" + encodeURIComponent(importUrl);
                    const response = await fetch(proxyUrl);
                    if (!response.ok) throw new Error("Network response was not ok");
                    const csvText = await response.text();
                    const rawData = parseCSV(csvText);
                    if (rawData.length === 0) throw new Error("拽抓 专拽");
                    const headerRowIndex = rawData.findIndex(row => row.some(cell => cell.includes('砖 专') || cell.includes('Company') || cell.includes('专')));
                    if (headerRowIndex === -1) throw new Error(" 爪 砖专转 转专转 转拽 -CSV");
                    const headers = rawData[headerRowIndex].map(h => h.trim());
                    const keyMap = { "拽专": "category", "转转": "subCategory", "砖 专": "company", "专": "company", "": "entryMechanism", "注专": "valueProp", "住专转": "acceleratorStrategy", "转": "insight", "驻": "phone", "": "email", "拽": "location", "": "domain" };
                    const columnIndices = {};
                    headers.forEach((header, index) => {
                        const foundKey = Object.keys(keyMap).find(k => header.includes(k));
                        if (foundKey) columnIndices[keyMap[foundKey]] = index;
                    });
                    let importCount = 0;
                    const colRef = collection(db, 'artifacts', appId, 'public', 'data', 'partners');
                    const batch = writeBatch(db);
                    let batchCount = 0;
                    for (let i = headerRowIndex + 1; i < rawData.length; i++) {
                        const row = rawData[i];
                        if (row.length <= 1 && (!row[0] || row[0].trim() === "")) continue;
                        const rowData = {};
                        let hasCompany = false;
                        Object.keys(columnIndices).forEach(key => {
                            const idx = columnIndices[key];
                            const val = row[idx] ? row[idx].trim() : "";
                            rowData[key] = val;
                            if (key === 'company' && val) hasCompany = true;
                        });
                        if (hasCompany) {
                            const newDocRef = doc(colRef);
                            batch.set(newDocRef, { ...rowData, contacted: false, note: "", createdAt: serverTimestamp() });
                            batchCount++;
                            importCount++;
                        }
                    }
                    if (batchCount > 0) await batch.commit();
                    showNotification('success', ` ${importCount} 砖转驻 爪!`);
                    setIsImportModalOpen(false);
                } catch (e) {
                    console.error(e);
                    showNotification('error', '砖  转: ' + e.message);
                } finally {
                    setLoading(false);
                }
            };

            const getLogoUrl = (domain, company) => domain ? `https://logo.clearbit.com/${domain}` : `https://ui-avatars.com/api/?name=${encodeURIComponent(company || "?")}&background=random&color=fff`;
            const formatForWhatsapp = (phone) => {
                if (!phone) return "";
                const clean = phone.replace(/\D/g, '');
                return clean.startsWith('0') ? `972${clean.substring(1)}` : `972${clean}`;
            };

            const categories = useMemo(() => ["", ...new Set(partners.map(p => p.category).filter(Boolean))], [partners]);
            const subCategories = useMemo(() => {
                if (selectedCategory === "") return [""];
                return ["", ...new Set(partners.filter(p => p.category === selectedCategory).map(p => p.subCategory).filter(Boolean))];
            }, [partners, selectedCategory]);

            const filteredPartners = useMemo(() => {
                return partners.filter(p => {
                    const term = searchTerm.toLowerCase();
                    const matchSearch = (p.company||"").toLowerCase().includes(term) || (p.valueProp||"").toLowerCase().includes(term);
                    const matchCat = selectedCategory === "" || p.category === selectedCategory;
                    const matchSub = filterSubCategory === "all" || filterSubCategory === "" || p.subCategory === filterSubCategory;
                    let matchStatus = true;
                    if (filterStatus === 'contacted') matchStatus = p.contacted;
                    if (filterStatus === 'not_contacted') matchStatus = !p.contacted;
                    return matchSearch && matchCat && matchSub && matchStatus;
                });
            }, [partners, searchTerm, selectedCategory, filterSubCategory, filterStatus]);

            // --- AI Logic (Live & Mock) ---
            const saveApiKey = (key) => {
                setApiKey(key);
                localStorage.setItem('gemini_api_key', key);
                setShowKeyInput(false);
                showNotification('success', key ? '驻转 AI 砖专!' : '驻转 住专, 注专 爪 ');
            };

            const handleAIAction = (partner, type) => {
                setAiPartner(partner);
                setAiContentType(type);
                setAiContentResult("");
                setCustomPrompt("");
                setAiMenuOpenId(null);
                setShowAIModal(true);
            };

            const generateMockResponse = (mode, partner) => {
                const company = partner.company || "专";
                const strategy = partner.acceleratorStrategy || "砖转";
                const value = partner.valueProp || "";
                const contact = "砖 拽砖专"; 

                return new Promise(resolve => {
                    setTimeout(() => {
                        let result = "";
                        switch (mode) {
                            case 'pitch':
                                result = `###  驻抓'  ( 驻转 AI)\n**驻抓' 拽爪专 -${company}:**\n\n砖 ${contact},\n砖 [砖 砖] -Starburst.  驻   转 驻爪 专 -${company}.\n\n 专 转 砖转祝 驻注 住 "${strategy}",  砖 砖   注专 砖注转 砖 "${value}". 砖 转 砖 拽爪专 拽转 转转.`;
                                break;
                            case 'message':
                                result = `###  注  ( 驻转 AI)\n**注转 驻 (LinkedIn/Email):**\n\n, \n转拽转 驻注转 砖 ${company} 专爪转  驻砖专转 砖转祝 驻注 住专. \n -Starburst 转拽 拽 住专驻 转, 驻转专 砖 专  专  砖 拽 专注 砖 ${strategy}.\n\n 转 驻 砖 拽爪专 砖注?`;
                                break;
                            case 'synergy':
                                result = `###  住专  ( 驻转 AI)\n**转 住专 注 ${company}:**\n\n1. **拽转 专:** 专 转 -${value},  砖砖 转 爪专 砖 驻转专转 注专 ${strategy}.\n2. **转 注住拽转:** 砖  砖 驻砖专  爪注 砖拽注/拽转 注专 住祝 转 -${partner.subCategory || ""}.\n3. **驻注 爪转:**  驻 拽 住  住 "${partner.entryMechanism || "POC"}" 拽转 转 专砖转.`;
                                break;
                            case 'custom':
                                result = `锔 **专砖 驻转 API 注专 拽砖转 砖转**\n\n 砖 砖转 驻砖转 ("${customPrompt}") , 砖 专 驻转 Gemini API 专转 (拽 驻转 注).\n\n注专 驻注转 住专转 (住专, , 驻砖) 注专转 注转 爪   驻转 爪  ( 转 注).`;
                                break;
                        }
                        resolve(result);
                    }, 1000);
                });
            };

            const generateAIContent = async () => {
                if (!aiPartner) return;
                setIsGeneratingAI(true);
                setAiContentResult("");

                const company = aiPartner.company || "专";
                const strategy = aiPartner.acceleratorStrategy || "N/A";
                const value = aiPartner.valueProp || "N/A";
                
                // If no API key, use mock logic
                if (!apiKey) {
                    const mockResult = await generateMockResponse(aiContentType, aiPartner);
                    setAiContentResult(mockResult);
                    setIsGeneratingAI(false);
                    return;
                }

                // Construct Prompt for Real API
                const baseContext = `You are a business development expert for 'Starburst', an Aerospace & Defense accelerator.
                Partner Details:
                Name: ${company}
                Category: ${aiPartner.category}
                Value Prop: ${value}
                Strategy: ${strategy}
                
                Task:`;

                let prompt = "";
                switch (aiContentType) {
                    case 'pitch':
                        prompt = `${baseContext} Write a short, professional elevator pitch (in Hebrew) introducing this company to a potential investor or corporate partner. Focus on their strategic value. Return Markdown.`;
                        break;
                    case 'message':
                        prompt = `${baseContext} Write a cold LinkedIn message (in Hebrew) to the CEO of this company, proposing a collaboration with Starburst. Keep it concise and engaging. Return Markdown.`;
                        break;
                    case 'synergy':
                        prompt = `${baseContext} Analyze the synergy between this company and Starburst. List 3 key bullet points (in Hebrew) explaining why this partnership makes sense. Return Markdown.`;
                        break;
                    case 'custom':
                        prompt = `${baseContext} ${customPrompt} (Answer in Hebrew). Return Markdown.`;
                        break;
                }

                // Failover Mechanism for Models
                // Updated to include Gemini 2.0 as a first try since user requested it
                const modelsToTry = [
                    "gemini-2.0-flash-exp",
                    "gemini-1.5-flash",
                    "gemini-1.5-flash-latest",
                    "gemini-pro"
                ];

                let success = false;
                let lastError = "";

                for (const model of modelsToTry) {
                    try {
                        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${apiKey}`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                        });

                        const data = await response.json();
                        
                        if (!response.ok) {
                            throw new Error(data.error?.message || response.statusText);
                        }
                        
                        const text = data.candidates?.[0]?.content?.parts?.[0]?.text;
                        if (text) {
                            setAiContentResult(text);
                            success = true;
                            break; // Success! Exit loop
                        }
                    } catch (e) {
                        console.warn(`Failed with ${model}:`, e);
                        lastError = e.message;
                    }
                }

                if (!success) {
                     setAiContentResult(`锔 **砖 专 -Gemini API**\n\n砖 专 砖转拽: ${lastError}\n\n**驻转专转 驻砖专:**\n1.  砖驻转 转拽  驻 转拽祝.\n2. **砖:**  砖驻注转 转 砖专转 "Generative Language API" -Google Cloud Console 注专 驻专拽 砖.\n3. 住 爪专 驻转 砖 驻专拽 专.`);
                }
                
                setIsGeneratingAI(false);
            };

            const copyToClipboard = (text) => {
                navigator.clipboard.writeText(text);
                showNotification('success', '拽住 注转拽 !');
            };

            return (
                <div className="min-h-screen flex flex-col pb-20" style={{ backgroundColor: THEME.bg }} onClick={() => setAiMenuOpenId(null)}>
                    {notification && <Toast type={notification.type} message={notification.message} onClose={() => setNotification(null)} />}

                    <style>{`
                        @import url('https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;700;900&display=swap');
                        body { font-family: 'Heebo', sans-serif; }
                    `}</style>

                    {/* HERO */}
                    <header className="text-white relative overflow-hidden" style={{ backgroundColor: THEME.dark }}>
                         <div className="absolute right-[-10%] top-[-50%] w-[50%] h-[200%] opacity-5 pointer-events-none" style={{ background: `radial-gradient(circle, ${THEME.yellow} 0%, transparent 70%)` }}></div>
                        <div className="max-w-7xl mx-auto px-6 py-16 relative z-10">
                            <div className="flex flex-col md:flex-row justify-between items-end gap-8">
                                <div>
                                    {/* LOGO HEADER SECTION */}
                                    <div className="flex items-center gap-6 mb-6">
                                        <img 
                                            src="./Starburst-Logo-White-svg-1.webp" 
                                            alt="Starburst" 
                                            className="h-10 md:h-12 object-contain"
                                        />
                                        <div className="h-8 w-px bg-white/30"></div>
                                        <div className="flex items-center gap-3">
                                            <img 
                                                src="./INNOVET_ICON-05-1.svg" 
                                                alt="Innovate" 
                                                className="h-8 md:h-10 object-contain"
                                                onError={(e) => { e.target.style.display = 'none'; }} 
                                            />
                                            <div className="flex flex-col text-white opacity-90">
                                                <span className="text-sm font-black tracking-tighter leading-none">INNOVET</span>
                                                <span className="text-[9px] font-bold text-[#FFC700] tracking-widest uppercase">Amit Ben Baruch</span>
                                            </div>
                                        </div>
                                    </div>

                                    <h1 className="text-6xl md:text-8xl font-black uppercase leading-[0.85] tracking-tighter mb-4">专<br/>砖转驻</h1>
                                    <p className="text-xl text-gray-400 font-light max-w-lg"> 拽砖专 住专  转.</p>
                                </div>
                                <div className="flex gap-4">
                                    <button onClick={() => setIsImportModalOpen(true)} className="group flex items-center gap-3 px-6 py-4 text-lg font-bold text-white border border-white/30 hover:bg-white/10 transition-all rounded-sm">
                                        <Icons.UploadCloud size={24} />  -CSV
                                    </button>
                                    <button onClick={() => { setEditingId('new'); setEditForm({ company: "", category: "", subCategory: "", phone: "", email: "", location: "", valueProp: "" }); setIsAddingNew(true); }} className="group flex items-center gap-3 px-8 py-4 text-lg font-bold text-black transition-all hover:scale-105 shadow-lg" style={{ backgroundColor: THEME.yellow }}>
                                        <Icons.Plus size={24} strokeWidth={3} /> 住祝 砖转祝
                                    </button>
                                </div>
                            </div>
                        </div>
                    </header>

                    {/* FILTERS & LAYOUT TOGGLE */}
                    <div className="sticky top-0 z-30 shadow-md backdrop-blur-md bg-white/90 border-b border-gray-200">
                        <div className="max-w-7xl mx-auto px-6 py-4 flex flex-col gap-4">
                            <div className="flex flex-col md:flex-row gap-4 justify-between items-center">
                                <div className="relative flex-1 w-full max-w-md">
                                    <input type="text" placeholder="驻砖 专, ..." className="w-full pl-4 pr-10 py-3 bg-gray-100 border border-transparent focus:bg-white focus:border-blue-600 outline-none transition-all rounded-none font-medium" value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} />
                                    <Icons.Search size={18} className="absolute top-3.5 right-3 text-gray-500" />
                                </div>
                                
                                <div className="flex items-center gap-2">
                                    <button 
                                        onClick={() => setLayoutMode(layoutMode === 'detailed' ? 'compact' : 'detailed')}
                                        className="flex items-center gap-2 px-4 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold rounded-none transition-colors border-l border-gray-300"
                                        title={layoutMode === 'detailed' ? '注专 转爪 爪爪转' : '注专 转爪 专转'}
                                    >
                                        {layoutMode === 'detailed' ? <Icons.Grid size={18} /> : <Icons.Layout size={18} />}
                                        <span className="hidden md:inline text-xs uppercase tracking-wide">{layoutMode === 'detailed' ? '转爪转 专' : '转爪 '}</span>
                                    </button>
                                    
                                    <div className="flex items-center gap-2 text-sm font-bold text-gray-500 bg-gray-100 px-4 py-3 rounded-none">
                                        {loading ? <Icons.RefreshCw size={16} className="animate-spin" /> : <Icons.Check size={16} className="text-green-500" />}
                                        <span>{filteredPartners.length}</span>
                                    </div>
                                </div>
                            </div>

                            <div ref={categoryListRef} className="flex items-center gap-2 overflow-x-auto pb-2 no-scrollbar -mx-6 px-6 md:mx-0 md:px-0 cursor-grab">
                                {categories.map(cat => (
                                    <button
                                        key={cat}
                                        onClick={() => { setSelectedCategory(cat); setFilterSubCategory("all"); }}
                                        className={`px-4 py-2 rounded-xl text-sm font-medium transition-all duration-200 whitespace-nowrap ${
                                            selectedCategory === cat
                                                ? "bg-[#cce8ff] text-[#001d35]"
                                                : "bg-white border border-[#E0E3E7] text-[#444746] hover:bg-[#E9EEF6]"
                                        }`}
                                    >
                                        {cat}
                                    </button>
                                ))}
                            </div>

                            <div className="flex flex-wrap gap-4 items-center text-sm">
                                <div className="flex items-center gap-2">
                                    <span className="font-bold text-gray-500">转转-拽专:</span>
                                    <select className="p-2 bg-gray-50 border border-gray-200 rounded outline-none focus:border-blue-500" value={filterSubCategory} onChange={(e) => setFilterSubCategory(e.target.value)} disabled={selectedCategory === ''}>
                                        {subCategories.map(cat => <option key={cat} value={cat}>{cat}</option>)}
                                    </select>
                                </div>

                                <div className="flex items-center gap-2 mr-auto">
                                    <span className="font-bold text-gray-500">住住:</span>
                                    <div className="flex bg-gray-100 p-1 rounded">
                                        <button onClick={() => setFilterStatus('all')} className={`px-3 py-1 rounded text-xs font-bold transition-all ${filterStatus === 'all' ? 'bg-white shadow text-black' : 'text-gray-500 hover:text-gray-700'}`}></button>
                                        <button onClick={() => setFilterStatus('contacted')} className={`px-3 py-1 rounded text-xs font-bold transition-all ${filterStatus === 'contacted' ? 'bg-green-100 text-green-700 shadow' : 'text-gray-500 hover:text-gray-700'}`}>爪专 拽砖专</button>
                                        <button onClick={() => setFilterStatus('not_contacted')} className={`px-3 py-1 rounded text-xs font-bold transition-all ${filterStatus === 'not_contacted' ? 'bg-red-50 text-red-600 shadow' : 'text-gray-500 hover:text-gray-700'}`}>专 驻</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* MAIN CONTENT AREA */}
                    <div className="max-w-7xl mx-auto px-6 py-6 flex-grow">
                         {loading && partners.length === 0 ? (
                            <div className="flex justify-center py-20">
                                <div className="animate-spin rounded-full h-12 w-12 border-t-4 border-b-4" style={{ borderColor: THEME.blue }}></div>
                            </div>
                        ) : (
                            <>
                                {/* --- DETAILED VIEW (Cards) --- */}
                                {layoutMode === 'detailed' && (
                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                                        {filteredPartners.map((partner) => (
                                            <div key={partner.id} className="bg-white border-2 border-transparent hover:border-blue-600 transition-all duration-300 group flex flex-col relative shadow-sm hover:shadow-xl" style={{ borderColor: partner.contacted ? '#48BB78' : 'transparent', backgroundColor: partner.contacted ? '#F0FFF4' : 'white' }}>
                                                <button onClick={() => toggleContact(partner)} className={`absolute top-0 right-0 px-3 py-1 text-xs font-black uppercase tracking-wider z-10 transition-colors ${partner.contacted ? 'bg-green-500 text-white' : 'bg-gray-200 text-gray-500 hover:bg-gray-300'}`}>
                                                    {partner.contacted ? '爪专 拽砖专 ' : '驻 驻'}
                                                </button>
                                                
                                                <div className="absolute top-0 left-0 flex z-10 opacity-0 group-hover:opacity-100 transition-opacity bg-gray-100/90 backdrop-blur-sm rounded-br-lg">
                                                     <button onClick={() => handleDelete(partner.id)} className="p-2 text-gray-400 hover:text-red-600 transition-colors" title="拽">
                                                        <Icons.Trash2 size={18} />
                                                    </button>
                                                    <button onClick={() => { setEditingId(partner.id); setEditForm(partner); setIsAddingNew(false); }} className="p-2 text-gray-400 hover:text-blue-600 transition-colors border-r border-gray-200" title="注专">
                                                        <Icons.Edit3 size={18} />
                                                    </button>
                                                </div>

                                                <div className="p-6 flex-grow flex flex-col">
                                                    <div className="flex items-start gap-4 mb-6 mt-4">
                                                        <div className="w-16 h-16 bg-gray-50 border border-gray-100 flex items-center justify-center p-2 shrink-0">
                                                            <img src={getLogoUrl(partner.domain, partner.company)} alt="" className="w-full h-full object-contain mix-blend-multiply" onError={(e) => e.target.src = `https://ui-avatars.com/api/?name=${partner.company}`} />
                                                        </div>
                                                        <div>
                                                            <h2 className="text-2xl font-black text-[#191B1D] leading-none mb-1">{partner.company}</h2>
                                                            <div className="flex items-center gap-1 text-sm text-gray-500 font-medium"><Icons.MapPin size={12} /> {partner.location || "砖专"}</div>
                                                            <div className="mt-2 inline-block px-2 py-0.5 bg-blue-50 text-blue-700 text-[10px] font-bold uppercase tracking-wide border border-blue-100">{partner.category}</div>
                                                        </div>
                                                    </div>

                                                    <div className="space-y-4 flex-grow">
                                                        {/* AI Saved Analysis Block (NEW) */}
                                                        {partner.aiAnalysis && (
                                                            <div className="bg-purple-50 border border-purple-100 rounded-lg p-3 text-sm mb-3">
                                                                <div className="flex items-center gap-2 mb-1 text-purple-700 font-bold text-xs uppercase">
                                                                    <Icons.Sparkles size={12} /> 转转 AI 砖专转
                                                                </div>
                                                                <div className="prose prose-sm prose-purple max-w-none text-gray-700 line-clamp-4 text-xs leading-relaxed" dangerouslySetInnerHTML={{ __html: marked.parse(partner.aiAnalysis) }}></div>
                                                            </div>
                                                        )}

                                                        {partner.valueProp && (
                                                            <div>
                                                                <div className="flex items-center gap-2 text-xs font-bold text-gray-400 uppercase mb-1"><Icons.Lightbulb size={12} /> 注专 住专</div>
                                                                <p className="text-sm font-medium text-gray-800 leading-relaxed">{partner.valueProp}</p>
                                                            </div>
                                                        )}
                                                        {partner.acceleratorStrategy && (
                                                            <div className="p-3 bg-yellow-50 border-r-4 border-yellow-400">
                                                                <div className="flex items-center gap-2 text-xs font-bold text-yellow-700 uppercase mb-1"><Icons.Rocket size={12} /> 住专转 砖转"驻</div>
                                                                <p className="text-sm font-bold text-gray-900 leading-relaxed">{partner.acceleratorStrategy}</p>
                                                            </div>
                                                        )}

                                                        <div className="mt-4 pt-4 border-t border-gray-100 flex flex-col gap-2">
                                                            {partner.phone && <div className="flex items-center gap-2 text-sm text-gray-600"><Icons.Phone size={14} className="text-gray-400 shrink-0" /><span dir="ltr" className="font-mono tracking-wide">{partner.phone}</span></div>}
                                                            {partner.email && <div className="flex items-center gap-2 text-sm text-gray-600"><Icons.Mail size={14} className="text-gray-400 shrink-0" /><span className="truncate">{partner.email}</span></div>}
                                                            {partner.entryMechanism && <div className="flex items-center gap-2 text-sm text-gray-600"><Icons.Zap size={14} className="text-gray-400 shrink-0" /><span><span className="font-bold text-xs text-gray-400">:</span> {partner.entryMechanism}</span></div>}
                                                        </div>
                                                    </div>
                                                    <div className="mt-6">
                                                        <textarea className="w-full text-sm bg-[#F9F9F9] border-b-2 border-gray-200 focus:border-yellow-400 outline-none p-2 resize-none min-h-[60px] transition-colors placeholder-gray-400" placeholder="注专转..." value={partner.note || ""} onChange={(e) => updateNoteLocalUI(partner.id, e.target.value)} onBlur={(e) => saveNote(partner.id, e.target.value)} />
                                                    </div>
                                                </div>
                                                <div className="px-6 py-4 bg-gray-50 border-t border-gray-100 grid grid-cols-4 gap-2">
                                                    <ActionButton href={partner.phone ? `tel:${partner.phone}` : null} icon={Icons.Phone} label="" colorClass="bg-white border border-gray-200 text-gray-700 hover:bg-gray-100" />
                                                    <ActionButton href={partner.email ? `mailto:${partner.email}` : null} icon={Icons.Mail} label="" colorClass="bg-blue-50 text-blue-700 hover:bg-blue-100" />
                                                    <ActionButton href={partner.phone ? `https://wa.me/${formatForWhatsapp(partner.phone)}` : null} icon={Icons.MessageCircle} label="" colorClass="bg-green-50 text-green-600 hover:bg-green-100" />
                                                    
                                                    {/* AI Button with Popover */}
                                                    <div className="relative">
                                                        <ActionButton onClick={(e) => { e.stopPropagation(); setAiMenuOpenId(aiMenuOpenId === partner.id ? null : partner.id); }} icon={Icons.Sparkles} label="爪专 转" colorClass="bg-purple-100 text-purple-700 hover:bg-purple-200" />
                                                        {aiMenuOpenId === partner.id && (
                                                            <div className="absolute bottom-full left-0 mb-2 w-48 bg-white shadow-xl border border-purple-100 rounded-lg p-2 z-20 flex flex-col gap-1 animate-fadeIn">
                                                                <button onClick={() => handleAIAction(partner, 'pitch')} className="text-right px-3 py-2 text-sm hover:bg-purple-50 rounded text-gray-700 font-medium"> 驻抓' 专</button>
                                                                <button onClick={() => handleAIAction(partner, 'message')} className="text-right px-3 py-2 text-sm hover:bg-purple-50 rounded text-gray-700 font-medium"> 注转 驻</button>
                                                                <button onClick={() => handleAIAction(partner, 'synergy')} className="text-right px-3 py-2 text-sm hover:bg-purple-50 rounded text-gray-700 font-medium"> 住专</button>
                                                                <div className="h-px bg-gray-100 my-1"></div>
                                                                <button onClick={() => handleAIAction(partner, 'custom')} className="text-right px-3 py-2 text-sm hover:bg-purple-50 rounded text-purple-700 font-bold">锔 拽砖 砖转...</button>
                                                            </div>
                                                        )}
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}

                                {/* --- COMPACT VIEW (Grid) --- */}
                                {layoutMode === 'compact' && (
                                    <div className="grid grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3 md:gap-4">
                                        {filteredPartners.map((partner) => (
                                            <div 
                                                key={partner.id} 
                                                onClick={() => setViewingId(partner.id)}
                                                className="bg-white border hover:border-blue-500 transition-all cursor-pointer shadow-sm hover:shadow-md rounded-lg p-2 flex flex-col items-center justify-center text-center aspect-square relative"
                                                style={{ borderColor: partner.contacted ? '#48BB78' : undefined, backgroundColor: partner.contacted ? '#F0FFF4' : 'white' }}
                                            >
                                                {partner.contacted && <div className="absolute top-1 right-1 w-2 h-2 rounded-full bg-green-500"></div>}
                                                <div className="w-10 h-10 md:w-14 md:h-14 mb-2 flex items-center justify-center">
                                                    <img src={getLogoUrl(partner.domain, partner.company)} alt="" className="w-full h-full object-contain mix-blend-multiply" onError={(e) => e.target.src = `https://ui-avatars.com/api/?name=${partner.company}`} />
                                                </div>
                                                <h3 className="text-[10px] md:text-xs font-bold text-gray-800 leading-tight line-clamp-2">{partner.company}</h3>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </>
                        )}
                    </div>

                    {/* AI MODAL */}
                    {showAIModal && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm" onClick={() => setShowAIModal(false)}>
                            <div className="bg-white w-full max-w-lg shadow-2xl flex flex-col rounded-xl overflow-hidden animate-slide-up" onClick={e => e.stopPropagation()}>
                                <div className="bg-gradient-to-r from-purple-600 to-blue-600 p-6 text-white flex justify-between items-center">
                                    <div className="flex items-center gap-2">
                                        <h2 className="text-2xl font-black flex items-center gap-2"><Icons.Sparkles size={24} /> Gemini AI</h2>
                                        <span className={`text-xs px-2 py-0.5 rounded font-bold ${apiKey ? 'bg-green-400 text-green-900' : 'bg-white/20 text-white'}`}>
                                            {apiKey ? 'Live' : 'Demo'}
                                        </span>
                                    </div>
                                    <div className="flex items-center gap-2">
                                        <button onClick={() => setShowKeyInput(!showKeyInput)} className="p-2 hover:bg-white/10 rounded-full transition-colors" title="专转 驻转"><Icons.Key size={20}/></button>
                                        <button onClick={() => setShowAIModal(false)} className="p-2 hover:bg-white/10 rounded-full transition-colors"><Icons.X size={24}/></button>
                                    </div>
                                </div>
                                
                                {showKeyInput && (
                                    <div className="bg-gray-100 p-4 border-b border-gray-200 animate-fadeIn">
                                        <p className="text-xs text-gray-500 mb-2"> 驻转 API 砖 Google Gemini 砖砖  .  驻转, 注专转 转驻注 爪 .</p>
                                        <div className="flex gap-2">
                                            <input 
                                                type="password" 
                                                className="flex-grow p-2 text-sm border rounded outline-none focus:border-purple-500" 
                                                placeholder="拽  转 驻转 -API" 
                                                value={apiKey} 
                                                onChange={(e) => setApiKey(e.target.value)} 
                                            />
                                            <button onClick={() => saveApiKey(apiKey)} className="px-4 py-1 bg-purple-600 text-white text-xs font-bold rounded hover:bg-purple-700">砖专</button>
                                        </div>
                                    </div>
                                )}
                                
                                <div className="p-6 overflow-y-auto max-h-[60vh]">
                                    {/* Content Type Selector (Hidden if Custom) */}
                                    {aiContentType !== 'custom' && (
                                        <div className="flex gap-2 mb-6 bg-gray-100 p-1 rounded-lg">
                                            <button onClick={() => setAiContentType('pitch')} className={`flex-1 py-2 text-sm font-bold rounded-md transition-all ${aiContentType === 'pitch' ? 'bg-white shadow text-purple-700' : 'text-gray-500 hover:text-gray-700'}`}>Pitch</button>
                                            <button onClick={() => setAiContentType('message')} className={`flex-1 py-2 text-sm font-bold rounded-md transition-all ${aiContentType === 'message' ? 'bg-white shadow text-purple-700' : 'text-gray-500 hover:text-gray-700'}`}>Message</button>
                                            <button onClick={() => setAiContentType('synergy')} className={`flex-1 py-2 text-sm font-bold rounded-md transition-all ${aiContentType === 'synergy' ? 'bg-white shadow text-purple-700' : 'text-gray-500 hover:text-gray-700'}`}>Synergy</button>
                                        </div>
                                    )}

                                    {/* Custom Prompt Input */}
                                    {aiContentType === 'custom' && (
                                        <div className="mb-4">
                                            <label className="block text-xs font-bold text-gray-500 mb-2 uppercase"> 专爪 拽砖 -Gemini?</label>
                                            <textarea 
                                                className="w-full p-3 border border-purple-200 rounded-lg focus:border-purple-500 outline-none text-sm bg-purple-50 min-h-[80px]"
                                                placeholder=": 转转   专转 拽爪专..."
                                                value={customPrompt}
                                                onChange={(e) => setCustomPrompt(e.target.value)}
                                            />
                                        </div>
                                    )}

                                    <div className="bg-purple-50 border border-purple-100 rounded-lg p-4 min-h-[200px] relative">
                                        {isGeneratingAI ? (
                                            <div className="absolute inset-0 flex flex-col items-center justify-center text-purple-600 bg-white/80 z-10 rounded-lg">
                                                <div className="animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-purple-600 mb-2"></div>
                                                <span className="text-xs font-bold animate-pulse">Gemini 转 转...</span>
                                            </div>
                                        ) : aiContentResult ? (
                                            <div className="prose prose-sm prose-purple max-w-none text-gray-800 leading-relaxed" dangerouslySetInnerHTML={{ __html: marked.parse(aiContentResult) }}></div>
                                        ) : (
                                            <div className="flex flex-col items-center justify-center h-full text-gray-400 py-10">
                                                <Icons.Bot size={40} className="mb-2 opacity-20" />
                                                <p className="text-xs">
                                                    {aiContentType === 'custom' ? ' 拽砖 抓 注 砖' : '抓 注 驻转专 爪专 '}
                                                </p>
                                            </div>
                                        )}
                                        
                                        {aiContentResult && !isGeneratingAI && (
                                            <div className="absolute top-2 left-2 flex gap-2">
                                                {/* New: Save Button inside result area */}
                                                <button onClick={() => saveAiToPartner(aiPartner.id, aiContentResult)} className="p-2 bg-white rounded-full shadow-sm hover:bg-green-50 text-green-600 transition-colors border border-transparent hover:border-green-200" title="砖专 专住 砖转祝">
                                                    <Icons.Save size={16} />
                                                </button>
                                                <button onClick={() => copyToClipboard(aiContentResult)} className="p-2 bg-white rounded-full shadow-sm hover:bg-gray-100 text-purple-600 transition-colors" title="注转拽">
                                                    <Icons.Copy size={16} />
                                                </button>
                                            </div>
                                        )}
                                    </div>
                                </div>

                                <div className="p-6 border-t border-gray-100 bg-gray-50 flex justify-end">
                                    <button onClick={generateAIContent} disabled={isGeneratingAI || (aiContentType === 'custom' && !customPrompt.trim())} className="px-6 py-3 bg-purple-600 hover:bg-purple-700 text-white font-bold rounded-lg shadow-md flex items-center gap-2 transition-all disabled:opacity-50 disabled:cursor-not-allowed">
                                        {aiContentType === 'custom' ? <Icons.Send size={18} /> : <Icons.Sparkles size={18} />}
                                        {isGeneratingAI ? '爪专 转...' : (aiContentType === 'custom' ? '砖 拽砖' : '爪专 转 ')}
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* VIEWER MODAL (Used in Compact Mode) */}
                    {activePartner && (
                        <div className="fixed inset-0 z-40 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm" onClick={() => setViewingId(null)}>
                            <div className="bg-white w-full max-w-lg shadow-2xl flex flex-col rounded-xl overflow-hidden animate-slide-up relative" onClick={e => e.stopPropagation()}>
                                <div className="absolute top-2 left-2 z-20">
                                    <button onClick={() => setViewingId(null)} className="p-2 bg-black/10 hover:bg-black/20 rounded-full text-black transition-colors"><Icons.X size={20} /></button>
                                </div>
                                <button onClick={() => toggleContact(activePartner)} className={`absolute top-0 right-0 px-4 py-2 text-xs font-black uppercase tracking-wider z-10 transition-colors rounded-bl-xl ${activePartner.contacted ? 'bg-green-500 text-white' : 'bg-gray-200 text-gray-500 hover:bg-gray-300'}`}>
                                    {activePartner.contacted ? '爪专 拽砖专 ' : '驻 驻'}
                                </button>

                                <div className="p-6 pb-0 flex-grow flex flex-col max-h-[70vh] overflow-y-auto">
                                    <div className="flex items-start gap-4 mb-6 mt-8">
                                        <div className="w-20 h-20 bg-gray-50 border border-gray-100 flex items-center justify-center p-2 shrink-0 rounded-lg">
                                            <img src={getLogoUrl(activePartner.domain, activePartner.company)} alt="" className="w-full h-full object-contain mix-blend-multiply" onError={(e) => e.target.src = `https://ui-avatars.com/api/?name=${activePartner.company}`} />
                                        </div>
                                        <div>
                                            <h2 className="text-3xl font-black text-[#191B1D] leading-none mb-1">{activePartner.company}</h2>
                                            <div className="flex items-center gap-1 text-sm text-gray-500 font-medium"><Icons.MapPin size={12} /> {activePartner.location || "砖专"}</div>
                                            <div className="mt-2 inline-block px-2 py-0.5 bg-blue-50 text-blue-700 text-[10px] font-bold uppercase tracking-wide border border-blue-100 rounded">{activePartner.category}</div>
                                        </div>
                                    </div>

                                    <div className="space-y-4">
                                        {/* AI Saved Analysis Block (NEW) - For Compact View Modal */}
                                        {activePartner.aiAnalysis && (
                                            <div className="bg-purple-50 border border-purple-100 rounded-lg p-3 text-sm mb-3">
                                                <div className="flex items-center gap-2 mb-1 text-purple-700 font-bold text-xs uppercase">
                                                    <Icons.Sparkles size={12} /> 转转 AI 砖专转
                                                </div>
                                                <div className="prose prose-sm prose-purple max-w-none text-gray-700 line-clamp-4 text-xs leading-relaxed" dangerouslySetInnerHTML={{ __html: marked.parse(activePartner.aiAnalysis) }}></div>
                                            </div>
                                        )}

                                        {activePartner.valueProp && (
                                            <div>
                                                <div className="flex items-center gap-2 text-xs font-bold text-gray-400 uppercase mb-1"><Icons.Lightbulb size={12} /> 注专 住专</div>
                                                <p className="text-sm font-medium text-gray-800 leading-relaxed bg-gray-50 p-3 rounded-lg border border-gray-100">{activePartner.valueProp}</p>
                                            </div>
                                        )}
                                        {activePartner.acceleratorStrategy && (
                                            <div className="p-3 bg-yellow-50 border-r-4 border-yellow-400 rounded-l-lg">
                                                <div className="flex items-center gap-2 text-xs font-bold text-yellow-700 uppercase mb-1"><Icons.Rocket size={12} /> 住专转 砖转"驻</div>
                                                <p className="text-sm font-bold text-gray-900 leading-relaxed">{activePartner.acceleratorStrategy}</p>
                                            </div>
                                        )}

                                        <div className="pt-4 border-t border-gray-100 flex flex-col gap-3">
                                            {activePartner.phone && <div className="flex items-center gap-3 text-sm text-gray-700"><div className="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-gray-500"><Icons.Phone size={14} /></div><span dir="ltr" className="font-mono tracking-wide font-bold">{activePartner.phone}</span></div>}
                                            {activePartner.email && <div className="flex items-center gap-3 text-sm text-gray-700"><div className="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-gray-500"><Icons.Mail size={14} /></div><span className="truncate font-medium">{activePartner.email}</span></div>}
                                            {activePartner.entryMechanism && <div className="flex items-center gap-3 text-sm text-gray-700"><div className="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-gray-500"><Icons.Zap size={14} /></div><span><span className="font-bold text-xs text-gray-400 uppercase">:</span> {activePartner.entryMechanism}</span></div>}
                                        </div>
                                    </div>
                                    
                                    <div className="mt-6 mb-6">
                                        <textarea className="w-full text-sm bg-[#F9F9F9] border-b-2 border-gray-200 focus:border-yellow-400 outline-none p-3 resize-none min-h-[80px] transition-colors placeholder-gray-400 rounded-t-lg" placeholder="注专转 砖转..." value={activePartner.note || ""} onChange={(e) => updateNoteLocalUI(activePartner.id, e.target.value)} onBlur={(e) => saveNote(activePartner.id, e.target.value)} />
                                    </div>
                                </div>

                                <div className="px-6 py-4 bg-gray-50 border-t border-gray-100">
                                    <div className="grid grid-cols-4 gap-2 mb-4">
                                        <ActionButton href={activePartner.phone ? `tel:${activePartner.phone}` : null} icon={Icons.Phone} label="" colorClass="bg-white border border-gray-200 text-gray-700 hover:bg-gray-100" />
                                        <ActionButton href={activePartner.email ? `mailto:${activePartner.email}` : null} icon={Icons.Mail} label="" colorClass="bg-blue-50 text-blue-700 hover:bg-blue-100" />
                                        <ActionButton href={activePartner.phone ? `https://wa.me/${formatForWhatsapp(activePartner.phone)}` : null} icon={Icons.MessageCircle} label="" colorClass="bg-green-50 text-green-600 hover:bg-green-100" />
                                        
                                        {/* AI Button with Popover in Viewer */}
                                        <div className="relative">
                                            <ActionButton onClick={(e) => { e.stopPropagation(); setAiMenuOpenId(aiMenuOpenId === activePartner.id ? null : activePartner.id); }} icon={Icons.Sparkles} label="爪专 转" colorClass="bg-purple-100 text-purple-700 hover:bg-purple-200" />
                                            {aiMenuOpenId === activePartner.id && (
                                                <div className="absolute bottom-full left-0 mb-2 w-48 bg-white shadow-xl border border-purple-100 rounded-lg p-2 z-20 flex flex-col gap-1 animate-fadeIn">
                                                    <button onClick={() => handleAIAction(activePartner, 'pitch')} className="text-right px-3 py-2 text-sm hover:bg-purple-50 rounded text-gray-700 font-medium"> 驻抓' 专</button>
                                                    <button onClick={() => handleAIAction(activePartner, 'message')} className="text-right px-3 py-2 text-sm hover:bg-purple-50 rounded text-gray-700 font-medium"> 注转 驻</button>
                                                    <button onClick={() => handleAIAction(activePartner, 'synergy')} className="text-right px-3 py-2 text-sm hover:bg-purple-50 rounded text-gray-700 font-medium"> 住专</button>
                                                    <div className="h-px bg-gray-100 my-1"></div>
                                                    <button onClick={() => handleAIAction(activePartner, 'custom')} className="text-right px-3 py-2 text-sm hover:bg-purple-50 rounded text-purple-700 font-bold">锔 拽砖 砖转...</button>
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                    <div className="flex justify-between items-center pt-2 border-t border-gray-200/50">
                                         <button onClick={() => handleDelete(activePartner.id)} className="text-red-400 hover:text-red-600 text-xs font-bold flex items-center gap-1"><Icons.Trash2 size={14} /> 拽</button>
                                         <button onClick={() => { setEditingId(activePartner.id); setEditForm(activePartner); setViewingId(null); setIsAddingNew(false); }} className="text-blue-500 hover:text-blue-700 text-xs font-bold flex items-center gap-1"><Icons.Edit3 size={14} /> 注专 驻专</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* STICKY BOTTOM FOOTER (Appears on scroll) */}
                    <div className={`fixed bottom-0 left-0 right-0 bg-[#17191A] text-white shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] z-30 footer-slide-up ${showBottomBar ? 'footer-visible' : 'footer-hidden'}`}>
                        <div className="max-w-7xl mx-auto px-6 h-16 flex justify-between items-center">
                            <div className="flex flex-col">
                                <span className="text-sm font-bold text-[#FFC700] uppercase tracking-wider">STARBURST</span>
                                <span className="text-xs text-gray-400"> 砖转驻</span>
                            </div>
                            
                            {/* Integrated Action Buttons */}
                            <div className="flex items-center gap-3">
                                <button 
                                    onClick={() => setIsImportModalOpen(true)}
                                    className="flex items-center gap-2 px-4 py-2 text-xs font-bold text-white border border-white/20 hover:bg-white/10 rounded transition-colors"
                                >
                                    <Icons.UploadCloud size={16} />
                                    <span className="hidden md:inline"></span>
                                </button>
                                <button 
                                    onClick={() => { setEditingId('new'); setEditForm({ company: "", category: "", subCategory: "", phone: "", email: "", location: "", valueProp: "" }); setIsAddingNew(true); }}
                                    className="flex items-center gap-2 px-4 py-2 text-xs font-bold text-black bg-[#FFC700] hover:bg-[#E5B300] rounded transition-colors shadow-sm"
                                >
                                    <Icons.Plus size={16} strokeWidth={3} />
                                    <span>住祝 砖转祝</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    {/* IMPORT MODAL */}
                    {isImportModalOpen && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm">
                            <div className="bg-white w-full max-w-lg shadow-2xl flex flex-col rounded-lg overflow-hidden">
                                <div className="p-6 border-b border-gray-100 flex justify-between items-center bg-gray-50">
                                    <h2 className="text-xl font-black text-[#191B1D]"> 砖转驻 -CSV</h2>
                                    <button onClick={() => setIsImportModalOpen(false)} className="text-gray-400 hover:text-red-500 transition-colors"><Icons.X size={24} /></button>
                                </div>
                                <div className="p-6 space-y-4">
                                    <p className="text-sm text-gray-600">拽  拽砖专 -Google Sheet 砖驻专住 -CSV (File &gt; Share &gt; Publish to web &gt; Comma-separated values).</p>
                                    <div>
                                        <label className="block text-xs font-bold text-gray-500 mb-1 uppercase">URL -CSV</label>
                                        <input className="w-full p-3 bg-gray-50 border border-gray-200 focus:border-blue-500 outline-none text-sm" 
                                            value={importUrl} onChange={e => setImportUrl(e.target.value)} placeholder="https://docs.google.com/..." />
                                    </div>
                                </div>
                                <div className="p-6 border-t border-gray-100 flex justify-end gap-3 bg-gray-50">
                                    <button onClick={() => setIsImportModalOpen(false)} className="px-4 py-2 font-bold text-gray-500 hover:bg-gray-200 transition-colors rounded"></button>
                                    <button onClick={handleImport} className="px-6 py-2 font-bold text-white bg-blue-600 hover:bg-blue-700 transition-all rounded shadow-sm flex items-center gap-2">
                                        {loading ? <Icons.RefreshCw className="animate-spin" size={16} /> : <Icons.UploadCloud size={16} />}  转
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* EDIT/ADD MODAL */}
                    {editingId && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm">
                            <div className="bg-white w-full max-w-2xl shadow-2xl flex flex-col max-h-[90vh] rounded-lg overflow-hidden">
                                <div className="p-6 border-b border-gray-100 flex justify-between items-center bg-gray-50">
                                    <h2 className="text-2xl font-black text-[#191B1D]">{isAddingNew ? "住驻转 砖转祝 砖" : "注专转 驻专 砖转祝"}</h2>
                                    <button onClick={() => setEditingId(null)} className="text-gray-400 hover:text-red-500 transition-colors"><Icons.X size={24} /></button>
                                </div>
                                <div className="p-8 overflow-y-auto grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div className="col-span-2 md:col-span-1"><label className="block text-xs font-bold text-gray-400 uppercase mb-1">砖 专</label><input className="w-full p-3 bg-gray-50 border border-gray-200 focus:border-blue-500 outline-none font-bold" value={editForm.company || ""} onChange={e => setEditForm({...editForm, company: e.target.value})} /></div>
                                    <div className="col-span-2 md:col-span-1"><label className="block text-xs font-bold text-gray-400 uppercase mb-1"> ()</label><input className="w-full p-3 bg-gray-50 border border-gray-200 focus:border-blue-500 outline-none" value={editForm.domain || ""} onChange={e => setEditForm({...editForm, domain: e.target.value})} placeholder="example.com" /></div>
                                    <div className="col-span-2"><label className="block text-xs font-bold text-gray-400 uppercase mb-1">注专 住专</label><textarea className="w-full p-3 bg-gray-50 border border-gray-200 focus:border-blue-500 outline-none" rows="2" value={editForm.valueProp || ""} onChange={e => setEditForm({...editForm, valueProp: e.target.value})} /></div>
                                    <div className="col-span-2"><label className="block text-xs font-bold text-gray-400 uppercase mb-1">住专转 砖转"驻</label><textarea className="w-full p-3 bg-yellow-50 border border-yellow-200 focus:border-yellow-400 outline-none font-medium" rows="2" value={editForm.acceleratorStrategy || ""} onChange={e => setEditForm({...editForm, acceleratorStrategy: e.target.value})} /></div>
                                    <div><label className="block text-xs font-bold text-gray-400 uppercase mb-1">驻</label><input className="w-full p-3 bg-gray-50 border border-gray-200 focus:border-blue-500 outline-none" value={editForm.phone || ""} onChange={e => setEditForm({...editForm, phone: e.target.value})} /></div>
                                    <div><label className="block text-xs font-bold text-gray-400 uppercase mb-1"></label><input className="w-full p-3 bg-gray-50 border border-gray-200 focus:border-blue-500 outline-none" value={editForm.email || ""} onChange={e => setEditForm({...editForm, email: e.target.value})} /></div>
                                    <div className="col-span-2 md:col-span-1"><label className="block text-xs font-bold text-gray-400 uppercase mb-1">拽专</label><input className="w-full p-3 bg-gray-50 border border-gray-200 focus:border-blue-500 outline-none" value={editForm.category || ""} onChange={e => setEditForm({...editForm, category: e.target.value})} /></div>
                                    <div className="col-span-2 md:col-span-1"><label className="block text-xs font-bold text-gray-400 uppercase mb-1">转转 拽专</label><input className="w-full p-3 bg-gray-50 border border-gray-200 focus:border-blue-500 outline-none" value={editForm.subCategory || ""} onChange={e => setEditForm({...editForm, subCategory: e.target.value})} /></div>
                                     <div className="col-span-2 md:col-span-1"><label className="block text-xs font-bold text-gray-400 uppercase mb-1"> 住</label><input className="w-full p-3 bg-gray-50 border border-gray-200 focus:border-blue-500 outline-none" value={editForm.entryMechanism || ""} onChange={e => setEditForm({...editForm, entryMechanism: e.target.value})} /></div>
                                </div>
                                <div className="p-6 border-t border-gray-100 flex justify-end gap-4 bg-gray-50">
                                    <button onClick={() => setEditingId(null)} className="px-6 py-3 font-bold text-gray-500 hover:bg-gray-200 transition-colors rounded"></button>
                                    <button onClick={handleSave} className="px-8 py-3 font-black text-black bg-[#FFC700] hover:bg-[#E5B300] transition-all shadow-md flex items-center gap-2 rounded"><Icons.Save size={18} /> 砖专 砖</button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
