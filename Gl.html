<!DOCTYPE html>
<html lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>גלריה מגנטית - אנימציית גדילה</title>
    <style>
        body {
            margin: 0;
            overflow-y: auto;
            overflow-x: hidden;
            background-color: #2c3e50;
        }

        #physics-container {
            width: 320px;
            max-width: 90%;
            height: 300vh; /* עדיין גבוה מאוד */
            position: relative;
            border-left: 2px solid #7f8c8d;
            border-right: 2px solid #7f8c8d;
            margin: 0 auto;
            background-color: #34495e;
            overflow: hidden;
        }

        .work-card {
            /* --- מצב התחלתי: קטן --- */
            width: 120px;
            height: 150px;
            position: absolute; /* חשוב מההתחלה */
            background-color: #e74c3c;
            color: white;
            padding: 10px; /* פדינג קטן יותר במצב קטן */
            border-radius: 8px; /* פינות מעוגלות במצב קטן */
            box-shadow: 2px 2px 5px rgba(0,0,0,0.3);
            cursor: grab;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            box-sizing: border-box;
            will-change: width, height, top, left; /* подсказка для браузера */
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;

            /* --- אנימציית המעבר --- */
            transition: width 0.8s ease-in-out,
                        height 0.8s ease-in-out,
                        top 0.6s ease-in-out, /* אנימציה גם למיקום */
                        left 0.6s ease-in-out,
                        padding 0.8s ease-in-out,
                        border-radius 0.8s ease-in-out;
        }

        /* --- מצב סופי: גדול (כאשר לקונטיינר יש קלאס 'grown') --- */
        .grown .work-card {
            width: 100%;
            height: 95vh; /* כמעט גובה חלון */
            padding: 20px; /* פדינג גדול יותר */
            border-radius: 0; /* פינות ישרות */
            border-bottom: 1px solid #c0392b;
            /* המיקום הסופי ייקבע ע"י הפיזיקה, אבל נותנים ערך ברירת מחדל */
            /* top ו- left ידרסו על ידי JavaScript אחרי שהפיזיקה תתחיל */
        }


        .work-card img {
            max-width: 80%; /* מתאים גם לגודל הקטן */
            max-height: 60%; /* מתאים גם לגודל הקטן */
            height: auto;
            margin-bottom: 5px;
            pointer-events: none;
             transition: max-width 0.8s ease-in-out, max-height 0.8s ease-in-out;
        }
         .grown .work-card img {
             max-width: 70%;
             max-height: 60%; /* שמירה על גודל תמונה סביר */
             margin-bottom: 15px;
         }


        .work-card span {
             font-size: 0.9em; /* גופן קטן במצב קטן */
             pointer-events: none;
             transition: font-size 0.8s ease-in-out;
        }
        .grown .work-card span {
            font-size: 1.2em; /* גופן גדול במצב גדול */
        }


    </style>
</head>
<body>

<div id="physics-container">
    <div class="work-card">
        <img src="placeholder.png" alt="עבודה 1">
        <span>כרטיס 1</span>
    </div>
    <div class="work-card">
        <img src="placeholder.png" alt="עבודה 2">
        <span>כרטיס 2</span>
    </div>
    <div class="work-card">
        <img src="placeholder.png" alt="עבודה 3">
        <span>כרטיס 3</span>
    </div>
     <div class="work-card">
        <span>טקסט בלבד 4</span>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/matter-attractors/0.1.6/matter-attractors.min.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const container = document.getElementById('physics-container');
        const cards = Array.from(container.querySelectorAll('.work-card'));
        let engine, runner, world, mouseConstraint, cardBodies = []; // משתנים גלובליים לסקריפט
        let physicsInitialized = false; // דגל למניעת אתחול כפול

        // --- שלב 1: מיקום התחלתי (כרטיסיות קטנות) ---
        let containerRect = container.getBoundingClientRect();
        const initialCardWidth = 120; // רוחב התחלתי CSS
        const initialCardHeight = 150; // גובה התחלתי CSS
        const stackStartY = 30;
        const cardSpacing = 5;

        cards.forEach((card, index) => {
            const initialX = containerRect.width / 2 - initialCardWidth / 2 + (Math.random() * 6 - 3);
            const initialY = stackStartY + index * (initialCardHeight + cardSpacing);
            card.style.left = `${initialX}px`;
            card.style.top = `${initialY}px`;
        });

        // הפעלת אנימציית הגדילה אחרי השהייה קלה
        setTimeout(() => {
            container.classList.add('grown');
        }, 100); // הפעלה כמעט מיידית

        // --- שלב 2: אתחול הפיזיקה אחרי סיום האנימציה ---
        const animationDuration = 800; // משך האנימציה ב-CSS (במילישניות)
        setTimeout(() => {
            initializePhysics();
        }, animationDuration + 150); // תזמון להרצה אחרי סיום האנימציה

        function initializePhysics() {
            if (physicsInitialized) return; // מונע אתחול כפול בטעות
            physicsInitialized = true;

            console.log("Initializing Physics..."); // Debugging

            if (typeof MatterAttractors === 'undefined') {
                console.error('MatterAttractors plugin not loaded!');
                return;
            }

            const Engine = Matter.Engine;
            const Runner = Matter.Runner;
            const Bodies = Matter.Bodies;
            const Body = Matter.Body;
            const Composite = Matter.Composite;
            const Mouse = Matter.Mouse;
            const MouseConstraint = Matter.MouseConstraint;
            const Events = Matter.Events;

            Matter.use('matter-attractors');

            engine = Engine.create();
            world = engine.world;
            engine.world.gravity.x = 0;
            engine.world.gravity.y = 0;

            // יצירה/עדכון קירות (ללא רצפה/תקרה)
            updateWalls();

            // יצירת גופים פיזיקליים (גדולים!)
            cardBodies = cards.map((card, index) => {
                // קבל מידות *אחרי* האנימציה
                const finalCardHeight = card.offsetHeight;
                const finalCardWidth = card.offsetWidth;

                // מיקום התחלתי לפיזור אנכי (כמו בגרסה הקודמת)
                const targetY = (index * (finalCardHeight * 1.05)) + finalCardHeight / 2 + 50; // מרווח קטן יותר
                const targetX = containerRect.width / 2;

                // ודא שמידות לא אפס (יכול לקרות אם האלמנט מוסתר)
                 if (finalCardWidth <= 0 || finalCardHeight <= 0) {
                    console.warn(`Card ${index} has zero dimensions after animation. Skipping physics body.`);
                    return null; // דלג על יצירת גוף פיזיקלי
                 }


                const body = Bodies.rectangle(
                    targetX, targetY, finalCardWidth, finalCardHeight,
                    {
                        frictionAir: 0.04,
                        friction: 0.01,
                        restitution: 0.3,
                        plugin: {
                            attractors: [
                                function(bodyA, bodyB) {
                                    let forceMagnitude = 0.005;
                                    let dx = bodyB.position.x - bodyA.position.x;
                                    let dy = bodyB.position.y - bodyA.position.y;
                                    let distanceSq = dx * dx + dy * dy;
                                    let minDistanceSq = 200 * 200; // לא למשוך אם קרובים מדי
                                    let maxDistanceSq = (window.innerHeight * 1.8) ** 2; // טווח משיכה גדול

                                    if (distanceSq < maxDistanceSq && distanceSq > minDistanceSq) {
                                       let force = (forceMagnitude * bodyA.mass * bodyB.mass) / distanceSq;
                                       let maxForce = 0.05;
                                       force = Math.min(force, maxForce);
                                       return { x: dx * force, y: dy * force };
                                    }
                                    return { x: 0, y: 0 };
                                }
                            ]
                        }
                    }
                );

                Body.setInertia(body, Infinity); // מניעת סיבוב

                body.element = card;
                card.body = body; // קישור הפוך אם רוצים
                return body;
            }).filter(body => body !== null); // סנן החוצה גופים שלא נוצרו

            Composite.add(world, cardBodies);

            // שליטה עם העכבר
            const mouse = Mouse.create(container);
            mouseConstraint = MouseConstraint.create(engine, {
                mouse: mouse,
                constraint: { stiffness: 0.1, render: { visible: false } }
            });
            Composite.add(world, mouseConstraint);

            // לולאת עדכון סנכרון HTML
            Events.on(engine, 'afterUpdate', syncPositions);

            // הרצת הסימולציה
            runner = Runner.create();
            Runner.run(runner, engine);
             console.log("Physics Engine Started.");
        }

        let leftWall, rightWall;
        const wallThickness = 100;
        const wallOptions = { isStatic: true, render: { visible: false } };

        function updateWalls() {
             containerRect = container.getBoundingClientRect();
             const wallHeight = containerRect.height * 1.1;

             // הסר קירות קודמים מהעולם הפיזיקלי אם הוא כבר אותחל
             if (world && leftWall) {
                 Composite.remove(world, [leftWall, rightWall]);
             }

             leftWall = Bodies.rectangle(-wallThickness / 2, containerRect.height / 2, wallThickness, wallHeight, wallOptions);
             rightWall = Bodies.rectangle(containerRect.width + wallThickness / 2, containerRect.height / 2, wallThickness, wallHeight, wallOptions);

              // הוסף קירות לעולם הפיזיקלי אם הוא כבר אותחל
             if (world) {
                Composite.add(world, [leftWall, rightWall]);
             }
        }

        function syncPositions() {
            if (!physicsInitialized) return;
             cardBodies.forEach(body => {
                const element = body.element;
                if (element) {
                    element.style.left = `${body.position.x - element.offsetWidth / 2}px`;
                    element.style.top = `${body.position.y - element.offsetHeight / 2}px`;
                    // אין עדכון סיבוב
                }
            });
        }


         // עדכון בשינוי גודל חלון
         window.addEventListener('resize', () => {
             // עדכן קירות פיזיקליים
             updateWalls();

             if (physicsInitialized) {
                 // עדכן גודל וקנה מידה של גופים פיזיקליים קיימים
                 cardBodies.forEach(body => {
                     const element = body.element;
                     const newCardHeight = window.innerHeight * 0.95;
                     const newCardWidth = containerRect.width; // כבר עודכן מ-updateWalls

                     element.style.height = `${newCardHeight}px`; // עדכן גם CSS

                     const currentWidth = body.bounds.max.x - body.bounds.min.x;
                     const currentHeight = body.bounds.max.y - body.bounds.min.y;

                     // מנע חלוקה באפס אם הגוף לא נוצר כראוי
                     if (currentWidth > 0 && currentHeight > 0) {
                        const scaleX = newCardWidth / currentWidth;
                        const scaleY = newCardHeight / currentHeight;
                        Body.scale(body, scaleX, scaleY);
                     }
                 });
             }
         });
    });
</script>

</body>
</html>

