<!DOCTYPE html>
<html lang="he">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>מקלדת דינאמית – עברית/אנגלית</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    html, body {
      height: 100%;
      width: 100%;
      overflow: hidden; /* למנוע גלילה כללית */
    }
    body {
      font-family: sans-serif;
      background: linear-gradient(135deg, #1e2023, #3c3f41);
      color: #eee;
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
      align-items: center;
      /* אנו רוצים שהמקלדת תהיה בתחתית, אז נגדיר container */
    }
    #toolbar {
      width: 100%;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.5rem 1rem;
      background: rgba(0,0,0,0.5);
    }
    #toolbar button {
      padding: 0.5rem 1rem;
      font-size: 16px;
      border-radius: 6px;
      border: none;
      background: #ddd;
      cursor: pointer;
      margin-left: 0.5rem;
      transition: background 0.2s ease;
    }
    #toolbar button:hover {
      background: #bbb;
    }
    #toolbar .title {
      font-size: 18px;
      font-weight: bold;
    }

    /* אזור המקלדת */
    .keyboard {
      width: 100%;
      /* נגדיר גובה ~40% מהמסך */
      height: 40vh;
      background: #ccc;
      display: flex;
      flex-direction: column;
      justify-content: space-evenly;
      align-items: center;
      padding: 0.5rem;
      touch-action: none; /* קריטי למנוע גרירת מסך (panning) בדפדפן מובייל */
    }
    .keyboard-row {
      display: flex;
      justify-content: center;
      align-items: center;
      width: 100%;
      margin: 0.2rem 0;
    }
    .key {
      background: #e0e0e0;
      border: 1px solid #999;
      border-radius: 8px;
      margin: 0.3rem;
      height: 3rem;
      min-width: 2.5rem;
      max-width: 4rem;
      flex: 1 1 auto;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: clamp(14px, 3vw, 24px);
      user-select: none;
      cursor: pointer;
      transition: background 0.1s ease;
      transform-origin: center center;
    }
    .key:hover {
      background: #ddd;
    }
  </style>
</head>
<body>
  <div id="toolbar">
    <div class="title">מקלדת דינאמית – עברית/אנגלית</div>
    <div>
      <button id="langToggle">עברית / אנגלית</button>
      <button id="resetBtn">איפוס</button>
    </div>
  </div>

  <!-- מקלדת -->
  <div class="keyboard" id="keyboard">
    <!-- נבנה את השורות בעזרת JavaScript -->
  </div>

  <script>
    // ======= הגדרות פריסת לועזית/עברית =======
    const layoutEnglish = [
      ["Q","W","E","R","T","Y","U","I","O","P"],
      ["A","S","D","F","G","H","J","K","L"],
      ["Z","X","C","V","B","N","M"]
    ];
    const layoutHebrew = [
      ["ק","ר","א","ט","ו","ן","ם","פ"],
      ["ש","ד","ג","כ","ע","י","ח","ל","ך","ף"],
      ["ז","ס","ב","ה","נ","מ","צ","ת","ץ"]
    ];

    let currentLayout = "english";
    let allKeys = [];

    // פונקציה לבניית המקלדת
    function buildKeyboard(layout) {
      const kb = document.getElementById('keyboard');
      kb.innerHTML = '';  // איפוס
      allKeys = [];

      for (let r = 0; r < layout.length; r++) {
        const rowDiv = document.createElement('div');
        rowDiv.className = 'keyboard-row';
        const rowArr = layout[r];
        for (let c = 0; c < rowArr.length; c++) {
          const keyDiv = document.createElement('div');
          keyDiv.className = 'key';
          keyDiv.textContent = rowArr[c];
          // אובייקט נתונים לכל מקש
          const keyObj = {
            element: keyDiv,
            letter: rowArr[c],
            currentScale: 1,
            targetScale: 1,
            offsetX: 0,
            offsetY: 0,
            targetOffsetX: 0,
            targetOffsetY: 0,
            lastInteraction: performance.now()
          };
          // אירוע קליק
          keyDiv.addEventListener('click', () => {
            // יכול להוסיף לוגיקה של 'הקלדה' בפועל
            keyObj.lastInteraction = performance.now();
          });
          rowDiv.appendChild(keyDiv);
          allKeys.push(keyObj);
        }
        kb.appendChild(rowDiv);
      }
    }
    buildKeyboard(layoutEnglish);

    // ======= מעבר בין אנגלית/עברית =======
    document.getElementById('langToggle').addEventListener('click', () => {
      if (currentLayout === 'english') {
        currentLayout = 'hebrew';
        buildKeyboard(layoutHebrew);
      } else {
        currentLayout = 'english';
        buildKeyboard(layoutEnglish);
      }
    });

    // ======= מעקב מגע/עכבר =======
    let pointerPos = null;

    function updatePointerPos(x, y) {
      pointerPos = { x, y };
    }
    function clearPointer() {
      pointerPos = null;
    }

    window.addEventListener('mousemove', e => updatePointerPos(e.clientX, e.clientY));
    window.addEventListener('touchstart', e => {
      // מונע גלילה ברירת מחדל
      e.preventDefault();
      const t = e.touches[0];
      updatePointerPos(t.clientX, t.clientY);
    }, {passive: false});
    window.addEventListener('touchmove', e => {
      e.preventDefault();
      const t = e.touches[0];
      updatePointerPos(t.clientX, t.clientY);
    }, {passive: false});
    window.addEventListener('touchend', e => {
      e.preventDefault();
      clearPointer();
    }, {passive: false});
    window.addEventListener('mouseout', () => clearPointer());

    // ======= לולאת אנימציה =======
    function animate() {
      for (let k of allKeys) {
        // חישוב מרכז המקש
        const rect = k.element.getBoundingClientRect();
        const centerX = rect.left + rect.width/2;
        const centerY = rect.top + rect.height/2;

        if (pointerPos) {
          // מרחק הסמן ממרכז המקש
          const dx = pointerPos.x - centerX;
          const dy = pointerPos.y - centerY;
          const dist = Math.sqrt(dx*dx + dy*dy);

          const closeThreshold = 40; // אם קרובים מאד
          const farThreshold = 200;  // אם רחוקים מאד
          const maxScale = 1.4;

          if (dist < closeThreshold) {
            k.targetScale = 1.0;
            k.targetOffsetX = dx * 0.1;
            k.targetOffsetY = dy * 0.1;
          } else {
            let ratio = (dist - closeThreshold) / (farThreshold - closeThreshold);
            ratio = Math.max(0, Math.min(ratio, 1));
            k.targetScale = 1 + ratio*(maxScale -1);
            k.targetOffsetX = dx * 0.15;
            k.targetOffsetY = dy * 0.15;
          }
          k.lastInteraction = performance.now();
        } else {
          // אם אין pointer זמן מה, נחזור למצב בסיס
          if (performance.now() - k.lastInteraction > 1500) {
            k.targetScale = 1;
            k.targetOffsetX = 0;
            k.targetOffsetY = 0;
          }
        }

        // Lerp
        const f = 0.12;  // מקדם הגעה חלקה
        k.currentScale += (k.targetScale - k.currentScale)*f;
        k.offsetX += (k.targetOffsetX - k.offsetX)*f;
        k.offsetY += (k.targetOffsetY - k.offsetY)*f;

        // Apply transform
        k.element.style.transform = `translate(${k.offsetX}px, ${k.offsetY}px) scale(${k.currentScale})`;
      }

      requestAnimationFrame(animate);
    }
    animate();

    // ======= איפוס =======
    document.getElementById('resetBtn').addEventListener('click', () => {
      for (let k of allKeys) {
        k.currentScale = 1;
        k.targetScale = 1;
        k.offsetX = 0;
        k.offsetY = 0;
        k.targetOffsetX = 0;
        k.targetOffsetY = 0;
        k.lastInteraction = performance.now();
        k.element.style.transform = '';
      }
    });
  </script>
</body>
</html>
