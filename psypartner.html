<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>◊û◊ê◊í◊® ◊©◊ï◊™◊§◊ô◊ù | Psychoflash</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Markdown Parser for AI responses -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;700;900&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');

        /* Theme Variables - Psychoflash */
        :root {
            --primary: #10B981; /* Emerald 500 */
            --primary-dark: #047857; /* Emerald 700 */
            --accent: #34D399; /* Emerald 400 */
            --bg-dark: #111827; /* Gray 900 */
            --bg-light: #F9FAFB; /* Gray 50 */
        }

        body { font-family: 'Heebo', sans-serif; background-color: var(--bg-light); color: #1F2937; }
        
        .font-tech { font-family: 'Orbitron', sans-serif; }

        /* Custom Scrollbar - EMERALD THEME */
        ::-webkit-scrollbar { width: 10px; height: 10px; }
        ::-webkit-scrollbar-track { background: #F1F1F1; }
        ::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 5px; border: 2px solid #F1F1F1; }
        ::-webkit-scrollbar-thumb:hover { background: var(--primary-dark); }

        /* Hide Scrollbar for Horizontal List but allow functionality */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* Cursor styles for dragging */
        .cursor-grab { cursor: grab; }
        .cursor-grabbing { cursor: grabbing; }

        .animate-spin { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        
        /* Slow Spin for Background */
        @keyframes spin-slow {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .animate-spin-slow {
            animation: spin-slow 60s linear infinite;
        }

        /* Toast Animation */
        @keyframes slideIn {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .toast-enter { animation: slideIn 0.3s ease-out forwards; }
        
        /* Footer Animation */
        .footer-slide-up { transition: transform 0.3s ease-in-out; }
        .footer-hidden { transform: translateY(100%); }
        .footer-visible { transform: translateY(0); }

        /* Mobile Grid Fixes */
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        /* Fade In Animation */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fadeIn {
            animation: fadeIn 0.2s ease-out forwards;
        }

        /* Markdown Styles within AI Modal */
        .prose h3 { font-weight: 800; margin-top: 1rem; margin-bottom: 0.5rem; color: #111827; }
        .prose p { margin-bottom: 0.8rem; line-height: 1.6; }
        .prose ul { list-style-type: disc; padding-right: 1.5rem; margin-bottom: 1rem; }
        .prose strong { color: var(--primary-dark); font-weight: 700; }
    </style>
</head>
<body class="relative overflow-x-hidden">
    <!-- Static Background Pattern -->
    <div class="fixed inset-0 z-0 opacity-[0.03] pointer-events-none" style="background-image: url('data:image/svg+xml,%3Csvg width=\'60\' height=\'60\' viewBox=\'0 0 60 60\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cg fill=\'none\' fill-rule=\'evenodd\'%3E%3Cg fill=\'%23000000\' fill-opacity=\'1\'%3E%3Cpath d=\'M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z\'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E');"></div>

    <div id="root" class="relative z-10"></div>

    <script type="text/babel" data-type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, doc, setDoc, updateDoc, deleteDoc, onSnapshot, serverTimestamp, query, orderBy, writeBatch } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const React = window.React;
        const { useState, useEffect, useMemo, useRef } = React;

        // --- Firebase Configuration ---
        const firebaseConfig = {
            apiKey: "AIzaSyDkEOW4aXGmuO_J-X5xJTw9Iyp0Q2pbUIY",
            authDomain: "psychoflash-control.firebaseapp.com",
            projectId: "psychoflash-control",
            storageBucket: "psychoflash-control.firebasestorage.app",
            messagingSenderId: "304053769812",
            appId: "1:304053769812:web:3b55fb16bbbda06b993fc1"
        };

        // Initialize Firebase
        let app, auth, db;
        const appId = 'psychoflash-network'; 

        try {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
        } catch (e) {
            console.error("Failed to initialize Firebase:", e);
        }

        // --- Custom Hooks ---
        const useDraggableScroll = (ref) => {
            useEffect(() => {
                const el = ref.current;
                if (!el) return;

                let isDown = false;
                let startX;
                let scrollLeft;

                const onMouseDown = (e) => {
                    if (e.button !== 0) return;
                    isDown = true;
                    el.classList.add('cursor-grabbing');
                    el.classList.remove('cursor-grab');
                    startX = e.pageX - el.offsetLeft;
                    scrollLeft = el.scrollLeft;
                };

                const onMouseLeave = () => {
                    isDown = false;
                    el.classList.remove('cursor-grabbing');
                    el.classList.add('cursor-grab');
                };

                const onMouseUp = () => {
                    isDown = false;
                    el.classList.remove('cursor-grabbing');
                    el.classList.add('cursor-grab');
                };

                const onMouseMove = (e) => {
                    if (!isDown) return;
                    e.preventDefault();
                    const x = e.pageX - el.offsetLeft;
                    const walk = (x - startX) * 1.5;
                    el.scrollLeft = scrollLeft - walk;
                };

                el.classList.add('cursor-grab');
                el.addEventListener('mousedown', onMouseDown);
                el.addEventListener('mouseleave', onMouseLeave);
                el.addEventListener('mouseup', onMouseUp);
                el.addEventListener('mousemove', onMouseMove);

                return () => {
                    el.removeEventListener('mousedown', onMouseDown);
                    el.removeEventListener('mouseleave', onMouseLeave);
                    el.removeEventListener('mouseup', onMouseUp);
                    el.removeEventListener('mousemove', onMouseMove);
                };
            }, [ref]);
        };

        // --- Icons ---
        const Icons = {
            Search: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>,
            Filter: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon></svg>,
            Phone: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg>,
            Mail: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>,
            MessageCircle: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path></svg>,
            MapPin: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>,
            Lightbulb: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="9" y1="18" x2="15" y2="18"></line><line x1="10" y1="22" x2="14" y2="22"></line><path d="M15.09 14c.18-.98.65-1.74 1.41-2.5A4.65 4.65 0 0 0 16 8c0-4.42-3.58-8-8-8s-8 3.58-8 8c0 2.08.73 3.97 1.92 5.48.1.13.2.25.3.37.66.77 1.12 1.53 1.28 2.5H15.09z"></path></svg>,
            Rocket: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z"></path><path d="M12 15l-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z"></path><path d="M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0"></path><path d="M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5"></path></svg>,
            Edit3: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M12 20h9"></path><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path></svg>,
            Trash2: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>,
            Plus: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>,
            Save: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg>,
            X: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>,
            RefreshCw: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg>,
            Check: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="20 6 9 17 4 12"></polyline></svg>,
            UploadCloud: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242"/><path d="M12 12v9"/><path d="m16 16-4-4-4 4"/></svg>,
            Zap: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>,
            Grid: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>,
            Layout: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="3" y1="9" x2="21" y2="9"></line><line x1="9" y1="21" x2="9" y2="9"></line></svg>,
            Sparkles: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M9 5H5"/><path d="M19 19v2"/><path d="M21 21h-2"/></svg>,
            Copy: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>,
            Send: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>,
            Bot: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect x="3" y="11" width="18" height="10" rx="2"></rect><circle cx="12" cy="5" r="2"></circle><path d="M12 7v4"></path><line x1="8" y1="16" x2="8" y2="16"></line><line x1="16" y1="16" x2="16" y2="16"></line></svg>,
            Key: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"></path></svg>,
            AlertTriangle: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>,
            Flash: ({size=24, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="currentColor" stroke="none" className={className}><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"></path></svg>,
            Settings: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>,
            DownloadCloud: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="8 17 12 21 16 17"></polyline><line x1="12" y1="12" x2="12" y2="21"></line><path d="M20.88 18.09A5 5 0 0 0 18 9h-1.26A8 8 0 1 0 3 16.29"></path></svg>
        };

        const THEME = {
            black: '#111827', // Dark Gray instead of pure black
            dark: '#1F2937',  // Gray 800
            yellow: '#10B981', // EMERALD (Primary)
            blue: '#3B82F6',  // Blue (Accent)
            bg: '#F9FAFB',    // Light Gray BG
            gray: '#E5E7EB',
            white: '#FFFFFF'
        };

        // --- CSV Parser ---
        const parseCSV = (str) => {
            const arr = [];
            let quote = false;
            for (let row = 0, col = 0, c = 0; c < str.length; c++) {
                let cc = str[c], nc = str[c+1];
                arr[row] = arr[row] || [];
                arr[row][col] = arr[row][col] || '';
                if (cc == '"' && quote && nc == '"') { arr[row][col] += cc; ++c; continue; }
                if (cc == '"') { quote = !quote; continue; }
                if (cc == ',' && !quote) { ++col; continue; }
                if (cc == '\r' && nc == '\n' && !quote) { ++row; col = 0; ++c; continue; }
                if (cc == '\n' && !quote) { ++row; col = 0; continue; }
                if (cc == '\r' && !quote) { ++row; col = 0; continue; }
                arr[row][col] += cc;
            }
            return arr;
        };

        // --- Components ---
        const Toast = ({ type, message, onClose }) => {
            if (!message) return null;
            return (
                <div className={`fixed bottom-20 left-4 z-50 px-6 py-4 rounded-lg shadow-xl flex items-center gap-3 toast-enter transform transition-all duration-300 ${type === 'success' ? 'bg-[#111827] text-white border-r-4 border-[#10B981]' : 'bg-red-600 text-white border-r-4 border-white'}`}>
                    {type === 'success' ? <Icons.Check size={20} className="text-[#10B981]" /> : <Icons.AlertTriangle size={20} />}
                    <span className="font-bold text-sm">{message}</span>
                    <button onClick={onClose} className="mr-4 text-white/50 hover:text-white"><Icons.X size={16} /></button>
                </div>
            );
        };

        const ActionButton = ({ href, onClick, icon: Icon, label, colorClass, className="" }) => {
            if (href) {
                return (
                    <a href={href} target={href.startsWith('http') ? "_blank" : undefined} className={`flex items-center justify-center gap-2 py-2 px-4 rounded font-bold text-sm transition-all duration-200 flex-1 shadow-sm cursor-pointer ${colorClass} ${className}`}>
                        <Icon size={16} /> <span>{label}</span>
                    </a>
                );
            }
            return (
                <button onClick={onClick} className={`flex items-center justify-center gap-2 py-2 px-4 rounded font-bold text-sm transition-all duration-200 flex-1 shadow-sm cursor-pointer ${colorClass} ${className}`}>
                    <Icon size={16} /> <span>{label}</span>
                </button>
            );
        };

        // --- Main App ---
        const App = () => {
            // --- üí° HARDCODED API KEY (Optional) üí° ---
            const HARDCODED_API_KEY = "AIzaSyD93hfZIPNGBm0uF0T0yWiCv16lE4nKfqw"; 

            const [partners, setPartners] = useState([]);
            const [loading, setLoading] = useState(true);
            const [user, setUser] = useState(null);
            const [searchTerm, setSearchTerm] = useState("");
            const [selectedCategory, setSelectedCategory] = useState("◊î◊õ◊ú");
            const [filterStatus, setFilterStatus] = useState("all"); 
            const [filterSubCategory, setFilterSubCategory] = useState("all");
            
            const [layoutMode, setLayoutMode] = useState(window.innerWidth < 768 ? 'compact' : 'detailed');

            const [editingId, setEditingId] = useState(null);
            const [viewingId, setViewingId] = useState(null);
            
            // AI Mock State
            const [showAIModal, setShowAIModal] = useState(false);
            const [aiPartner, setAiPartner] = useState(null);
            const [aiContentType, setAiContentType] = useState('pitch'); 
            const [aiContentResult, setAiContentResult] = useState("");
            const [isGeneratingAI, setIsGeneratingAI] = useState(false);
            const [customPrompt, setCustomPrompt] = useState("");
            const [aiMenuOpenId, setAiMenuOpenId] = useState(null);
            
            // AI Key State
            const [apiKey, setApiKey] = useState(HARDCODED_API_KEY || localStorage.getItem('gemini_api_key') || "");
            const [showKeyInput, setShowKeyInput] = useState(false);
            
            // Updated default model to one you have
            const [apiModel, setApiModel] = useState(localStorage.getItem('gemini_model') || "gemini-2.5-flash"); 
            const [availableModels, setAvailableModels] = useState([]);
            const [testConnectionStatus, setTestConnectionStatus] = useState(null);

            const [editForm, setEditForm] = useState({});
            const [isAddingNew, setIsAddingNew] = useState(false);
            const [isImportModalOpen, setIsImportModalOpen] = useState(false);
            const [importUrl, setImportUrl] = useState("https://docs.google.com/spreadsheets/d/e/2PACX-1vQSkgkIvL4h1048RW_HiR-qnodnGw_XoVJZ9x_6sdgkMdTg9FN4ggtcW681YwM2jGSj8YoBAKxFP7Gw/pub?output=csv");
            const [notification, setNotification] = useState(null);
            const [showBottomBar, setShowBottomBar] = useState(false);

            const categoryListRef = useRef(null);
            useDraggableScroll(categoryListRef); // --- RESTORED! ---

            const activePartner = useMemo(() => partners.find(p => p.id === viewingId), [partners, viewingId]);

            const showNotification = (type, message) => {
                setNotification({ type, message });
                setTimeout(() => setNotification(null), 3500);
            };

            useEffect(() => {
                const handleScroll = () => setShowBottomBar(window.scrollY > 250);
                window.addEventListener('scroll', handleScroll);
                return () => window.removeEventListener('scroll', handleScroll);
            }, []);

            useEffect(() => {
                const initAuth = async () => {
                    try {
                        await signInAnonymously(auth);
                    } catch (e) {
                        console.error("Auth failed", e);
                        setLoading(false);
                    }
                };
                initAuth();
                return onAuthStateChanged(auth, (u) => setUser(u));
            }, []);

            useEffect(() => {
                if (!user) return;
                const q = collection(db, 'artifacts', appId, 'public', 'data', 'partners');
                const unsubscribe = onSnapshot(q, (snapshot) => {
                    let docs = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    docs.sort((a, b) => (a.company || "").localeCompare(b.company || ""));
                    setPartners(docs);
                    setLoading(false);
                }, (err) => {
                    console.error("Sync error", err);
                    setLoading(false);
                });
                return () => unsubscribe();
            }, [user]);

            const toggleContact = async (partner) => {
                if (!user) return;
                try {
                    const ref = doc(db, 'artifacts', appId, 'public', 'data', 'partners', partner.id);
                    await updateDoc(ref, { contacted: !partner.contacted });
                    showNotification('success', partner.contacted ? '◊°◊ò◊ò◊ï◊° ◊¢◊ï◊ì◊õ◊ü: ◊ú◊ê ◊†◊ï◊¶◊® ◊ß◊©◊®' : '◊°◊ò◊ò◊ï◊° ◊¢◊ï◊ì◊õ◊ü: ◊†◊ï◊¶◊® ◊ß◊©◊®');
                } catch(e) { console.error(e); showNotification('error', '◊©◊í◊ô◊ê◊î ◊ë◊¢◊ì◊õ◊ï◊ü'); }
            };

            const handleDelete = async (id) => {
                if (!user) return;
                if (!window.confirm("◊î◊ê◊ù ◊ú◊û◊ó◊ï◊ß ◊©◊ï◊™◊£ ◊ñ◊î ◊ú◊¶◊û◊ô◊™◊ï◊™?")) return;
                try {
                    if (!id) throw new Error("Invalid ID");
                    await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'partners', id));
                    setViewingId(null);
                    setEditingId(null);
                    showNotification('success', '◊î◊©◊ï◊™◊£ ◊†◊û◊ó◊ß ◊ë◊î◊¶◊ú◊ó◊î');
                } catch (e) {
                    console.error("Delete failed:", e);
                    showNotification('error', '◊©◊í◊ô◊ê◊î ◊ë◊û◊ó◊ô◊ß◊î');
                }
            };

            const handleSave = async () => {
                if (!user) return;
                const colRef = collection(db, 'artifacts', appId, 'public', 'data', 'partners');
                const data = { ...editForm };
                try {
                    if (isAddingNew) {
                        await setDoc(doc(colRef), { ...data, contacted: false, note: "", createdAt: serverTimestamp() });
                        showNotification('success', '◊©◊ï◊™◊£ ◊ó◊ì◊© ◊†◊ï◊°◊£ ◊ë◊î◊¶◊ú◊ó◊î');
                    } else {
                        await updateDoc(doc(colRef, editingId), data);
                        showNotification('success', '◊î◊§◊®◊ò◊ô◊ù ◊†◊©◊û◊®◊ï ◊ë◊î◊¶◊ú◊ó◊î');
                    }
                    setEditingId(null);
                    setEditForm({});
                    setIsAddingNew(false);
                } catch(e) {
                    console.error("Save failed:", e);
                    showNotification('error', '◊©◊í◊ô◊ê◊î ◊ë◊©◊û◊ô◊®◊î');
                }
            };

            const saveNote = async (id, text) => {
                if (!user) return;
                try {
                    await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'partners', id), { note: text });
                } catch(e) { console.error(e); }
            };
            
            const saveAiToPartner = async (partnerId, content) => {
                if (!user) return;
                try {
                    await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'partners', partnerId), { 
                        aiAnalysis: content 
                    });
                    showNotification('success', '◊î◊™◊ï◊ë◊†◊î ◊†◊©◊û◊®◊î ◊ë◊õ◊®◊ò◊ô◊° ◊î◊©◊ï◊™◊£');
                } catch(e) { 
                    console.error(e); 
                    showNotification('error', '◊©◊í◊ô◊ê◊î ◊ë◊©◊û◊ô◊®◊î');
                }
            };

            const updateNoteLocalUI = (id, text) => {
                 setPartners(prev => prev.map(p => p.id === id ? { ...p, note: text } : p));
            };

            const handleImport = async () => {
                if (!user) return;
                setLoading(true);
                try {
                    const proxyUrl = "https://api.allorigins.win/raw?url=" + encodeURIComponent(importUrl);
                    const response = await fetch(proxyUrl);
                    if (!response.ok) throw new Error("Network response was not ok");
                    const csvText = await response.text();
                    const rawData = parseCSV(csvText);
                    if (rawData.length === 0) throw new Error("◊ß◊ï◊ë◊• ◊®◊ô◊ß");
                    const headerRowIndex = rawData.findIndex(row => row.some(cell => cell.includes('◊©◊ù ◊î◊ó◊ë◊®◊î') || cell.includes('Company') || cell.includes('◊ó◊ë◊®◊î')));
                    if (headerRowIndex === -1) throw new Error("◊ú◊ê ◊†◊û◊¶◊ê◊î ◊©◊ï◊®◊™ ◊õ◊ï◊™◊®◊™ ◊™◊ß◊ô◊†◊î ◊ë-CSV");
                    const headers = rawData[headerRowIndex].map(h => h.trim());
                    const keyMap = { "◊ß◊ò◊í◊ï◊®◊ô◊î": "category", "◊™◊™": "subCategory", "◊©◊ù ◊î◊ó◊ë◊®◊î": "company", "◊ó◊ë◊®◊î": "company", "◊û◊†◊í◊†◊ï◊ü": "entryMechanism", "◊¢◊®◊ö": "valueProp", "◊ê◊°◊ò◊®◊ò◊í◊ô◊ô◊™": "acceleratorStrategy", "◊™◊ï◊ë◊†◊î": "insight", "◊ò◊ú◊§◊ï◊ü": "phone", "◊û◊ô◊ô◊ú": "email", "◊û◊ô◊ß◊ï◊ù": "location", "◊ì◊ï◊û◊ô◊ô◊ü": "domain" };
                    const columnIndices = {};
                    headers.forEach((header, index) => {
                        const foundKey = Object.keys(keyMap).find(k => header.includes(k));
                        if (foundKey) columnIndices[keyMap[foundKey]] = index;
                    });
                    let importCount = 0;
                    const colRef = collection(db, 'artifacts', appId, 'public', 'data', 'partners');
                    const batch = writeBatch(db);
                    let batchCount = 0;
                    for (let i = headerRowIndex + 1; i < rawData.length; i++) {
                        const row = rawData[i];
                        if (row.length <= 1 && (!row[0] || row[0].trim() === "")) continue;
                        const rowData = {};
                        let hasCompany = false;
                        Object.keys(columnIndices).forEach(key => {
                            const idx = columnIndices[key];
                            const val = row[idx] ? row[idx].trim() : "";
                            rowData[key] = val;
                            if (key === 'company' && val) hasCompany = true;
                        });
                        if (hasCompany) {
                            const newDocRef = doc(colRef);
                            batch.set(newDocRef, { ...rowData, contacted: false, note: "", createdAt: serverTimestamp() });
                            batchCount++;
                            importCount++;
                        }
                    }
                    if (batchCount > 0) await batch.commit();
                    showNotification('success', `◊ô◊ï◊ë◊ê◊ï ${importCount} ◊©◊ï◊™◊§◊ô◊ù ◊ë◊î◊¶◊ú◊ó◊î!`);
                    setIsImportModalOpen(false);
                } catch (e) {
                    console.error(e);
                    showNotification('error', '◊©◊í◊ô◊ê◊î ◊ë◊ô◊ô◊ë◊ï◊ê ◊î◊†◊™◊ï◊†◊ô◊ù: ' + e.message);
                } finally {
                    setLoading(false);
                }
            };

            const getLogoUrl = (domain, company) => domain ? `https://logo.clearbit.com/${domain}` : `https://ui-avatars.com/api/?name=${encodeURIComponent(company || "?")}&background=random&color=10B981&color=fff`; // Changed fallback color to Green
            const formatForWhatsapp = (phone) => {
                if (!phone) return "";
                const clean = phone.replace(/\D/g, '');
                return clean.startsWith('0') ? `972${clean.substring(1)}` : `972${clean}`;
            };

            const categories = useMemo(() => ["◊î◊õ◊ú", ...new Set(partners.map(p => p.category).filter(Boolean))], [partners]);
            const subCategories = useMemo(() => {
                if (selectedCategory === "◊î◊õ◊ú") return ["◊î◊õ◊ú"];
                return ["◊î◊õ◊ú", ...new Set(partners.filter(p => p.category === selectedCategory).map(p => p.subCategory).filter(Boolean))];
            }, [partners, selectedCategory]);

            const filteredPartners = useMemo(() => {
                return partners.filter(p => {
                    const term = searchTerm.toLowerCase();
                    const matchSearch = (p.company||"").toLowerCase().includes(term) || (p.valueProp||"").toLowerCase().includes(term);
                    const matchCat = selectedCategory === "◊î◊õ◊ú" || p.category === selectedCategory;
                    const matchSub = filterSubCategory === "all" || filterSubCategory === "◊î◊õ◊ú" || p.subCategory === filterSubCategory;
                    let matchStatus = true;
                    if (filterStatus === 'contacted') matchStatus = p.contacted;
                    if (filterStatus === 'not_contacted') matchStatus = !p.contacted;
                    return matchSearch && matchCat && matchSub && matchStatus;
                });
            }, [partners, searchTerm, selectedCategory, filterSubCategory, filterStatus]);

            // --- AI Logic (Live & Mock) ---
            
            // --- AUTO MODEL DISCOVERY ---
            const fetchAvailableModels = async (key) => {
                const k = key || apiKey;
                if (!k) return;
                
                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models?key=${k}`);
                    const data = await response.json();
                    
                    if (data.models) {
                        const validModels = data.models
                            .filter(m => m.supportedGenerationMethods && m.supportedGenerationMethods.includes("generateContent"))
                            .map(m => m.name.replace("models/", ""));
                        
                        setAvailableModels(validModels);
                        
                        // Prioritize specific model if user hasn't set one
                        if (validModels.length > 0 && !validModels.includes(apiModel)) {
                            const betterModel = validModels.find(m => m.includes("2.5-flash")) || validModels[0];
                            setApiModel(betterModel);
                            localStorage.setItem('gemini_model', betterModel);
                        }
                        return validModels;
                    }
                } catch (e) {
                    console.error("Failed to fetch models", e);
                }
                return [];
            };

            useEffect(() => {
                if(apiKey) fetchAvailableModels(apiKey);
            }, []);

            const saveApiKey = (key) => {
                setApiKey(key);
                localStorage.setItem('gemini_api_key', key);
                setShowKeyInput(false);
                fetchAvailableModels(key);
                showNotification('success', key ? '◊û◊§◊™◊ó AI ◊†◊©◊û◊®!' : '◊û◊§◊™◊ó ◊î◊ï◊°◊®, ◊¢◊ï◊ë◊® ◊ú◊û◊¶◊ë ◊ê◊ï◊ò◊ï◊û◊ò◊ô');
            };
            
            const saveModel = (model) => {
                setApiModel(model);
                localStorage.setItem('gemini_model', model);
                setTestConnectionStatus(null);
            };

            const handleAIAction = (partner, type) => {
                setAiPartner(partner);
                setAiContentType(type);
                setAiContentResult("");
                setCustomPrompt("");
                setAiMenuOpenId(null);
                setShowAIModal(true);
            };

            const generateMockResponse = (mode, partner) => {
                const company = partner.company || "◊î◊ó◊ë◊®◊î";
                const strategy = partner.acceleratorStrategy || "◊ó◊ì◊©◊†◊ï◊™";
                const value = partner.valueProp || "◊ò◊õ◊†◊ï◊ú◊ï◊í◊ô◊î";
                const contact = "◊ê◊ô◊© ◊ß◊©◊®"; 

                return new Promise(resolve => {
                    setTimeout(() => {
                        let result = "";
                        switch (mode) {
                            case 'pitch':
                                result = `### üé§ ◊§◊ô◊•' ◊û◊ì◊ï◊û◊î (◊ú◊ú◊ê ◊û◊§◊™◊ó AI)\n**◊§◊ô◊•' ◊ß◊¶◊® ◊ú-${company}:**\n\n◊©◊ú◊ï◊ù ${contact},\n◊©◊û◊ô [◊î◊©◊ù ◊©◊ú◊ö] ◊û-Psychoflash. ◊ê◊†◊ô ◊§◊ï◊†◊î ◊ê◊ú◊ô◊õ◊ù ◊õ◊ô ◊ñ◊ô◊î◊ô◊™◊ô ◊§◊ï◊ò◊†◊¶◊ô◊ê◊ú ◊ê◊ì◊ô◊® ◊ë-${company}.\n\n◊ê◊†◊ï ◊®◊ï◊ê◊ô◊ù ◊î◊ñ◊ì◊û◊†◊ï◊™ ◊ú◊©◊ô◊™◊ï◊£ ◊§◊¢◊ï◊ú◊î ◊°◊ë◊ô◊ë "${strategy}", ◊ï◊û◊ê◊û◊ô◊†◊ô◊ù ◊©◊î◊ò◊õ◊†◊ï◊ú◊ï◊í◊ô◊î ◊©◊ú◊õ◊ù ◊ô◊õ◊ï◊ú◊î ◊ú◊î◊ë◊ô◊ê ◊¢◊®◊ö ◊û◊©◊û◊¢◊ï◊™◊ô ◊©◊ú "${value}". ◊ê◊©◊û◊ó ◊ú◊™◊ê◊ù ◊©◊ô◊ó◊î ◊ß◊¶◊®◊î ◊ú◊ë◊ì◊ô◊ß◊™ ◊î◊ô◊™◊õ◊†◊ï◊™.`;
                                break;
                            case 'message':
                                result = `### üìß ◊î◊ï◊ì◊¢◊î ◊û◊ì◊ï◊û◊î (◊ú◊ú◊ê ◊û◊§◊™◊ó AI)\n**◊î◊ï◊ì◊¢◊™ ◊§◊†◊ô◊ô◊î (LinkedIn/Email):**\n\n◊î◊ô◊ô, \n◊†◊™◊ß◊ú◊™◊ô ◊ë◊§◊¢◊ô◊ú◊ï◊™ ◊©◊ú ${company} ◊ï◊®◊¶◊ô◊™◊ô ◊ú◊ë◊ó◊ï◊ü ◊ê◊§◊©◊®◊ï◊™ ◊ú◊©◊ô◊™◊ï◊£ ◊§◊¢◊ï◊ú◊î ◊ê◊°◊ò◊®◊ò◊í◊ô. \n◊ê◊†◊ó◊†◊ï ◊ë-Psychoflash ◊û◊™◊û◊ß◊ì◊ô◊ù ◊ë◊ß◊ô◊ì◊ï◊ù ◊°◊ò◊ê◊®◊ò◊ê◊§◊ô◊ù ◊ë◊™◊ó◊ï◊ù, ◊ï◊î◊§◊™◊®◊ï◊ü ◊©◊ú◊õ◊ù ◊†◊®◊ê◊î ◊û◊ê◊ï◊ì ◊®◊ú◊ï◊ï◊†◊ò◊ô ◊ú◊û◊î◊ú◊õ◊ô◊ù ◊©◊ê◊†◊ï ◊û◊ß◊ì◊û◊ô◊ù ◊õ◊®◊í◊¢ ◊ë◊†◊ï◊©◊ê ${strategy}.\n\n◊î◊ê◊ù ◊™◊î◊ô◊î ◊§◊†◊ï◊ô ◊ú◊©◊ô◊ó◊î ◊ß◊¶◊®◊î ◊î◊©◊ë◊ï◊¢?`;
                                break;
                            case 'synergy':
                                result = `### ü§ù ◊°◊ô◊†◊®◊í◊ô◊î ◊û◊ì◊ï◊û◊î (◊ú◊ú◊ê ◊û◊§◊™◊ó AI)\n**◊†◊ô◊™◊ï◊ó ◊°◊ô◊†◊®◊í◊ô◊î ◊¢◊ù ${company}:**\n\n1. **◊†◊ß◊ï◊ì◊™ ◊î◊ó◊ô◊ë◊ï◊®:** ◊î◊ó◊ë◊®◊î ◊û◊™◊û◊ó◊î ◊ë-${value}, ◊û◊î ◊©◊û◊©◊ú◊ô◊ù ◊ê◊™ ◊î◊¶◊ï◊®◊ö ◊©◊ú◊†◊ï ◊ë◊§◊™◊®◊ï◊†◊ï◊™ ◊¢◊ë◊ï◊® ${strategy}.\n2. **◊î◊ñ◊ì◊û◊†◊ï◊™ ◊¢◊°◊ß◊ô◊™:** ◊©◊ô◊ú◊ï◊ë ◊î◊ò◊õ◊†◊ï◊ú◊ï◊í◊ô◊î ◊©◊ú◊î◊ù ◊ô◊ê◊§◊©◊® ◊ú◊†◊ï ◊ú◊î◊¶◊ô◊¢ ◊ú◊û◊©◊ß◊ô◊¢◊ô◊ù/◊ú◊ß◊ï◊ó◊ï◊™ ◊¢◊®◊ö ◊û◊ï◊°◊£ ◊ë◊™◊ó◊ï◊ù ◊î-${partner.subCategory || "◊ò◊õ◊†◊ï◊ú◊ï◊í◊ô◊î"}.\n3. **◊§◊¢◊ï◊ú◊î ◊û◊ï◊û◊ú◊¶◊™:** ◊ú◊ô◊ñ◊ï◊ù ◊§◊ô◊ô◊ú◊ï◊ò ◊û◊û◊ï◊ß◊ì ◊°◊ë◊ô◊ë ◊û◊†◊í◊†◊ï◊ü ◊î◊õ◊†◊ô◊°◊î "${partner.entryMechanism || "POC"}" ◊ú◊ë◊ì◊ô◊ß◊™ ◊î◊™◊ê◊û◊î ◊®◊ê◊©◊ï◊†◊ô◊™.`;
                                break;
                            case 'custom':
                                result = `‚ö†Ô∏è **◊†◊ì◊®◊© ◊û◊§◊™◊ó API ◊¢◊ë◊ï◊® ◊ë◊ß◊©◊ï◊™ ◊ê◊ô◊©◊ô◊ï◊™**\n\n◊õ◊ì◊ô ◊ú◊©◊ú◊ï◊ó ◊©◊ê◊ú◊ï◊™ ◊ó◊ï◊§◊©◊ô◊ï◊™ ("${customPrompt}") ◊ú◊û◊ï◊ì◊ú, ◊ô◊© ◊ú◊î◊í◊ì◊ô◊® ◊û◊§◊™◊ó Gemini API ◊ë◊î◊í◊ì◊®◊ï◊™ (◊ê◊ô◊ô◊ß◊ï◊ü ◊î◊û◊§◊™◊ó ◊ú◊û◊¢◊ú◊î).\n\n◊¢◊ë◊ï◊® ◊§◊¢◊ï◊ú◊ï◊™ ◊°◊ò◊†◊ì◊®◊ò◊ô◊ï◊™ (◊°◊ô◊†◊®◊í◊ô◊î, ◊û◊ô◊ô◊ú, ◊§◊í◊ô◊©◊î) ◊î◊û◊¢◊®◊õ◊™ ◊¢◊ï◊ë◊ì◊™ ◊û◊¶◊ï◊ô◊ü ◊í◊ù ◊ú◊ú◊ê ◊û◊§◊™◊ó ◊ë◊û◊¶◊ë ◊ê◊ï◊ò◊ï◊û◊ò◊ô (◊õ◊û◊ï ◊ë◊ì◊ï◊í◊û◊ê◊ï◊™ ◊ú◊û◊¢◊ú◊î).`;
                                break;
                        }
                        resolve(result);
                    }, 1000);
                });
            };
            
            // --- Unified Fetch Function ---
            const fetchGeminiResponse = async (prompt, testOnly = false) => {
                // Updated fallback models prioritizing 2.5 and new Flash models
                // Removed 'gemini-pro' to avoid the "not supported" error
                const fallbackModels = [
                    'gemini-2.5-flash-preview-09-2025',
                    'gemini-2.5-flash',
                    'gemini-2.5-pro',
                    'gemini-2.0-flash-exp',
                    'gemini-2.0-flash',
                    'gemini-1.5-flash'
                ];
                
                const modelsToTry = availableModels.length > 0 ? [apiModel, ...availableModels] : [apiModel, ...fallbackModels];
                const uniqueModels = [...new Set(modelsToTry)];
                
                let lastError = null;

                for (const model of uniqueModels) {
                    if(!model) continue;
                    try {
                        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${apiKey}`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                        });

                        const data = await response.json();
                        
                        if (data.error) {
                            if (testOnly && model === apiModel) throw new Error(data.error.message);
                            if (data.error.message.includes("API key")) throw new Error("API Key invalid");
                            
                            console.warn(`Model ${model} failed: ${data.error.message}`);
                            lastError = data.error.message;
                            continue;
                        }
                        
                        return data.candidates?.[0]?.content?.parts?.[0]?.text;
                    } catch (e) {
                        lastError = e.message;
                        if (e.message.includes("API Key invalid")) throw e;
                        continue;
                    }
                }
                throw new Error(`All models failed. Last error: ${lastError}`);
            };
            
            const testConnection = async () => {
                setTestConnectionStatus('loading');
                try {
                    await fetchGeminiResponse("Hello", true); 
                    setTestConnectionStatus('success');
                    showNotification('success', '◊ó◊ô◊ë◊ï◊® ◊™◊ß◊ô◊ü!');
                } catch (e) {
                    setTestConnectionStatus('error');
                    setAiResult(`‚ùå ◊©◊í◊ô◊ê◊™ ◊ó◊ô◊ë◊ï◊®: ${e.message}`);
                }
            };

            const generateAIContent = async () => {
                if (!aiPartner) return;
                setIsGeneratingAI(true);
                setAiContentResult("");

                const company = aiPartner.company || "◊î◊ó◊ë◊®◊î";
                const strategy = aiPartner.acceleratorStrategy || "N/A";
                const value = aiPartner.valueProp || "N/A";
                
                // If no API key, use mock logic
                if (!apiKey) {
                    const mockResult = await generateMockResponse(aiContentType, aiPartner);
                    setAiContentResult(mockResult);
                    setIsGeneratingAI(false);
                    return;
                }

                // Construct Prompt for Real API
                const baseContext = `You are a business development expert for 'Psychoflash', an Accelerator.
                Partner Details:
                Name: ${company}
                Category: ${aiPartner.category}
                Value Prop: ${value}
                Strategy: ${strategy}
                
                Task:`;

                let prompt = "";
                switch (aiContentType) {
                    case 'pitch':
                        prompt = `${baseContext} Write a short, professional elevator pitch (in Hebrew) introducing this company to a potential investor or corporate partner. Focus on their strategic value. Return Markdown.`;
                        break;
                    case 'message':
                        prompt = `${baseContext} Write a cold LinkedIn message (in Hebrew) to the CEO of this company, proposing a collaboration with Psychoflash. Keep it concise and engaging. Return Markdown.`;
                        break;
                    case 'synergy':
                        prompt = `${baseContext} Analyze the synergy between this company and Psychoflash. List 3 key bullet points (in Hebrew) explaining why this partnership makes sense. Return Markdown.`;
                        break;
                    case 'custom':
                        prompt = `${baseContext} ${customPrompt} (Answer in Hebrew). Return Markdown.`;
                        break;
                }

                try {
                    const text = await fetchGeminiResponse(prompt);
                    setAiContentResult(text || "No response generated.");
                } catch (e) {
                     setAiContentResult(`‚ö†Ô∏è **◊©◊í◊ô◊ê◊î ◊ë◊ó◊ô◊ë◊ï◊® ◊ú-Gemini API**\n\n◊î◊©◊í◊ô◊ê◊î ◊î◊ê◊ó◊®◊ï◊†◊î ◊©◊î◊™◊ß◊ë◊ú◊î: ${e.message}\n\n**◊§◊™◊®◊ï◊†◊ï◊™ ◊ê◊§◊©◊®◊ô◊ô◊ù:**\n1. ◊ï◊ï◊ì◊ê ◊©◊î◊û◊§◊™◊ó ◊™◊ß◊ô◊ü ◊ï◊ú◊ê ◊§◊í ◊™◊ï◊ß◊£.\n2. **◊ó◊©◊ï◊ë:** ◊ï◊ï◊ì◊ê ◊©◊î◊§◊¢◊ú◊™ ◊ê◊™ ◊©◊ô◊®◊ï◊™ "Generative Language API" ◊ë-Google Cloud Console ◊¢◊ë◊ï◊® ◊î◊§◊®◊ï◊ô◊ß◊ò ◊©◊ú◊ö.\n3. ◊†◊°◊î ◊ú◊ô◊¶◊ï◊® ◊û◊§◊™◊ó ◊ó◊ì◊© ◊ë◊§◊®◊ï◊ô◊ß◊ò ◊ê◊ó◊®.`);
                } finally {
                    setIsGeneratingAI(false);
                }
            };

            const copyToClipboard = (text) => {
                navigator.clipboard.writeText(text);
                showNotification('success', '◊î◊ò◊ß◊°◊ò ◊î◊ï◊¢◊™◊ß ◊ú◊ú◊ï◊ó!');
            };

            return (
                <div className="min-h-screen flex flex-col pb-20" style={{ backgroundColor: THEME.bg }} onClick={() => setAiMenuOpenId(null)}>
                    {notification && <Toast type={notification.type} message={notification.message} onClose={() => setNotification(null)} />}

                    {/* HERO */}
                    <header className="text-white relative overflow-hidden" style={{ backgroundColor: THEME.black }}>
                         <div className="absolute right-[-10%] top-[-50%] w-[50%] h-[200%] opacity-5 pointer-events-none" style={{ background: `radial-gradient(circle, ${THEME.yellow} 0%, transparent 70%)` }}></div>
                         {/* Psychoflash Lightning BG */}
                         <div className="absolute -left-20 -top-20 z-0 opacity-[0.05] pointer-events-none text-emerald-500"><Icons.Flash size={600} fill="currentColor" /></div>

                        <div className="max-w-7xl mx-auto px-6 py-16 relative z-10">
                            <div className="flex flex-col md:flex-row justify-between items-end gap-8">
                                <div>
                                    {/* LOGO HEADER SECTION */}
                                    <div className="flex items-center gap-6 mb-6">
                                        <div className="flex items-center gap-3 group">
                                            <div className="p-2 bg-emerald-500 rounded-none rotate-3 shadow-sm transform transition-transform group-hover:rotate-6">
                                                <Icons.Flash size={32} className="text-white rotate-[-3deg]" fill="currentColor" />
                                            </div>
                                            <span className="text-3xl font-black tracking-tighter uppercase italic text-white font-tech">PSYCHOFLASH</span>
                                        </div>
                                        <div className="h-8 w-px bg-white/30"></div>
                                        <div className="flex items-center gap-3">
                                            <div className="flex flex-col text-white opacity-90">
                                                <span className="text-sm font-black tracking-tighter leading-none font-tech">NETWORK V2.0</span>
                                                <span className="text-[9px] font-bold text-emerald-400 tracking-widest uppercase">Connected Intelligence</span>
                                            </div>
                                        </div>
                                    </div>

                                    <h1 className="text-6xl md:text-8xl font-black uppercase leading-[0.85] tracking-tighter mb-4">◊û◊ê◊í◊®<br/><span className="text-emerald-400">◊î◊©◊ï◊™◊§◊ô◊ù</span></h1>
                                    <p className="text-xl text-gray-400 font-light max-w-lg">◊†◊ô◊î◊ï◊ú ◊ß◊©◊®◊ô◊ù ◊ê◊°◊ò◊®◊ò◊í◊ô◊ô◊ù ◊ï◊ë◊ô◊†◊î ◊¢◊°◊ß◊ô◊™.</p>
                                </div>
                                <div className="flex gap-4">
                                    <button onClick={() => setIsImportModalOpen(true)} className="group flex items-center gap-3 px-6 py-4 text-lg font-bold text-white border border-white/30 hover:bg-white/10 transition-all rounded-sm">
                                        <Icons.UploadCloud size={24} /> ◊ô◊ô◊ë◊ï◊ê ◊û-CSV
                                    </button>
                                    <button onClick={() => { setEditingId('new'); setEditForm({ company: "", category: "", subCategory: "", phone: "", email: "", location: "", valueProp: "" }); setIsAddingNew(true); }} className="group flex items-center gap-3 px-8 py-4 text-lg font-bold text-white bg-emerald-600 hover:bg-emerald-700 transition-all hover:scale-105 shadow-lg">
                                        <Icons.Plus size={24} strokeWidth={3} /> ◊î◊ï◊°◊£ ◊©◊ï◊™◊£
                                    </button>
                                </div>
                            </div>
                        </div>
                    </header>

                    {/* FILTERS & LAYOUT TOGGLE */}
                    <div className="sticky top-0 z-30 shadow-md backdrop-blur-md bg-white/90 border-b border-gray-200">
                        <div className="max-w-7xl mx-auto px-6 py-4 flex flex-col gap-4">
                            <div className="flex flex-col md:flex-row gap-4 justify-between items-center">
                                <div className="relative flex-1 w-full max-w-md">
                                    <input type="text" placeholder="◊ó◊ô◊§◊ï◊© ◊ó◊ë◊®◊î, ◊ò◊õ◊†◊ï◊ú◊ï◊í◊ô◊î..." className="w-full pl-4 pr-10 py-3 bg-gray-100 border border-transparent focus:bg-white focus:border-emerald-500 outline-none transition-all rounded-none font-medium" value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} />
                                    <Icons.Search size={18} className="absolute top-3.5 right-3 text-gray-500" />
                                </div>
                                
                                <div className="flex items-center gap-2">
                                    <button 
                                        onClick={() => setLayoutMode(layoutMode === 'detailed' ? 'compact' : 'detailed')}
                                        className="flex items-center gap-2 px-4 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold rounded-none transition-colors border-l border-gray-300"
                                        title={layoutMode === 'detailed' ? '◊¢◊ë◊ï◊® ◊ú◊™◊¶◊ï◊í◊î ◊û◊¶◊ï◊û◊¶◊û◊™' : '◊¢◊ë◊ï◊® ◊ú◊™◊¶◊ï◊í◊î ◊û◊ï◊®◊ó◊ë◊™'}
                                    >
                                        {layoutMode === 'detailed' ? <Icons.Grid size={18} /> : <Icons.Layout size={18} />}
                                        <span className="hidden md:inline text-xs uppercase tracking-wide">{layoutMode === 'detailed' ? '◊™◊¶◊ï◊í◊™ ◊í◊®◊ô◊ì' : '◊™◊¶◊ï◊í◊î ◊û◊ú◊ê◊î'}</span>
                                    </button>
                                    
                                    <div className="flex items-center gap-2 text-sm font-bold text-gray-500 bg-gray-100 px-4 py-3 rounded-none">
                                        {loading ? <Icons.RefreshCw size={16} className="animate-spin" /> : <Icons.Check size={16} className="text-emerald-500" />}
                                        <span>{filteredPartners.length}</span>
                                    </div>
                                </div>
                            </div>

                            <div ref={categoryListRef} className="flex items-center gap-2 overflow-x-auto pb-2 no-scrollbar -mx-6 px-6 md:mx-0 md:px-0 cursor-grab">
                                {categories.map(cat => (
                                    <button
                                        key={cat}
                                        onClick={() => { setSelectedCategory(cat); setFilterSubCategory("all"); }}
                                        className={`px-4 py-2 rounded-xl text-sm font-medium transition-all duration-200 whitespace-nowrap ${
                                            selectedCategory === cat
                                                ? "bg-emerald-100 text-emerald-800 border border-emerald-200"
                                                : "bg-white border border-[#E0E3E7] text-[#444746] hover:bg-[#E9EEF6]"
                                        }`}
                                    >
                                        {cat}
                                    </button>
                                ))}
                            </div>

                            <div className="flex flex-wrap gap-4 items-center text-sm">
                                <div className="flex items-center gap-2">
                                    <span className="font-bold text-gray-500">◊™◊™-◊ß◊ò◊í◊ï◊®◊ô◊î:</span>
                                    <select className="p-2 bg-gray-50 border border-gray-200 rounded outline-none focus:border-emerald-500" value={filterSubCategory} onChange={(e) => setFilterSubCategory(e.target.value)} disabled={selectedCategory === '◊î◊õ◊ú'}>
                                        {subCategories.map(cat => <option key={cat} value={cat}>{cat}</option>)}
                                    </select>
                                </div>

                                <div className="flex items-center gap-2 mr-auto">
                                    <span className="font-bold text-gray-500">◊°◊ò◊ò◊ï◊°:</span>
                                    <div className="flex bg-gray-100 p-1 rounded">
                                        <button onClick={() => setFilterStatus('all')} className={`px-3 py-1 rounded text-xs font-bold transition-all ${filterStatus === 'all' ? 'bg-white shadow text-black' : 'text-gray-500 hover:text-gray-700'}`}>◊î◊õ◊ú</button>
                                        <button onClick={() => setFilterStatus('contacted')} className={`px-3 py-1 rounded text-xs font-bold transition-all ${filterStatus === 'contacted' ? 'bg-green-100 text-green-700 shadow' : 'text-gray-500 hover:text-gray-700'}`}>◊†◊ï◊¶◊® ◊ß◊©◊®</button>
                                        <button onClick={() => setFilterStatus('not_contacted')} className={`px-3 py-1 rounded text-xs font-bold transition-all ${filterStatus === 'not_contacted' ? 'bg-red-50 text-red-600 shadow' : 'text-gray-500 hover:text-gray-700'}`}>◊ò◊®◊ù ◊ò◊ï◊§◊ú</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* MAIN CONTENT AREA */}
                    <div className="max-w-7xl mx-auto px-6 py-6 flex-grow">
                         {loading && partners.length === 0 ? (
                            <div className="flex justify-center py-20">
                                <div className="animate-spin rounded-full h-12 w-12 border-t-4 border-b-4" style={{ borderColor: THEME.yellow }}></div>
                            </div>
                        ) : (
                            <>
                                {/* --- DETAILED VIEW (Cards) --- */}
                                {layoutMode === 'detailed' && (
                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                                        {filteredPartners.map((partner) => (
                                            <div key={partner.id} className="bg-white border-2 border-transparent hover:border-emerald-500 transition-all duration-300 group flex flex-col relative shadow-sm hover:shadow-xl" style={{ borderColor: partner.contacted ? '#10B981' : 'transparent', backgroundColor: partner.contacted ? '#ECFDF5' : 'white' }}>
                                                <button onClick={() => toggleContact(partner)} className={`absolute top-0 right-0 px-3 py-1 text-xs font-black uppercase tracking-wider z-10 transition-colors ${partner.contacted ? 'bg-emerald-500 text-white' : 'bg-gray-200 text-gray-500 hover:bg-gray-300'}`}>
                                                    {partner.contacted ? '◊†◊ï◊¶◊® ◊ß◊©◊® ‚úì' : '◊ú◊§◊†◊ô ◊§◊†◊ô◊ô◊î'}
                                                </button>
                                                
                                                <div className="absolute top-0 left-0 flex z-10 opacity-0 group-hover:opacity-100 transition-opacity bg-gray-100/90 backdrop-blur-sm rounded-br-lg">
                                                     <button onClick={() => handleDelete(partner.id)} className="p-2 text-gray-400 hover:text-red-600 transition-colors" title="◊û◊ó◊ß">
                                                        <Icons.Trash2 size={18} />
                                                    </button>
                                                    <button onClick={() => { setEditingId(partner.id); setEditForm(partner); setIsAddingNew(false); }} className="p-2 text-gray-400 hover:text-emerald-600 transition-colors border-r border-gray-200" title="◊¢◊®◊ï◊ö">
                                                        <Icons.Edit3 size={18} />
                                                    </button>
                                                </div>

                                                <div className="p-6 flex-grow flex flex-col">
                                                    <div className="flex items-start gap-4 mb-6 mt-4">
                                                        <div className="w-16 h-16 bg-gray-50 border border-gray-100 flex items-center justify-center p-2 shrink-0">
                                                            <img src={getLogoUrl(partner.domain, partner.company)} alt="" className="w-full h-full object-contain mix-blend-multiply" onError={(e) => e.target.src = `https://ui-avatars.com/api/?name=${partner.company}&background=random&color=10B981&color=fff`} />
                                                        </div>
                                                        <div>
                                                            <h2 className="text-2xl font-black text-[#191B1D] leading-none mb-1">{partner.company}</h2>
                                                            <div className="flex items-center gap-1 text-sm text-gray-500 font-medium"><Icons.MapPin size={12} /> {partner.location || "◊ô◊©◊®◊ê◊ú"}</div>
                                                            <div className="mt-2 inline-block px-2 py-0.5 bg-emerald-50 text-emerald-700 text-[10px] font-bold uppercase tracking-wide border border-emerald-100">{partner.category}</div>
                                                        </div>
                                                    </div>

                                                    <div className="space-y-4 flex-grow">
                                                        {/* --- RESTORED: AI Saved Analysis Block --- */}
                                                        {partner.aiAnalysis && (
                                                            <div className="bg-purple-50 border border-purple-100 rounded-lg p-3 text-sm mb-3">
                                                                <div className="flex items-center gap-2 mb-1 text-purple-700 font-bold text-xs uppercase">
                                                                    <Icons.Sparkles size={12} /> ◊™◊ï◊ë◊†◊ï◊™ AI ◊©◊û◊ï◊®◊ï◊™
                                                                </div>
                                                                <div className="prose prose-sm prose-purple max-w-none text-gray-700 line-clamp-4 text-xs leading-relaxed" dangerouslySetInnerHTML={{ __html: marked.parse(partner.aiAnalysis) }}></div>
                                                            </div>
                                                        )}

                                                        {partner.valueProp && (
                                                            <div>
                                                                <div className="flex items-center gap-2 text-xs font-bold text-gray-400 uppercase mb-1"><Icons.Lightbulb size={12} /> ◊¢◊®◊ö ◊ê◊°◊ò◊®◊ò◊í◊ô</div>
                                                                <p className="text-sm font-medium text-gray-800 leading-relaxed">{partner.valueProp}</p>
                                                            </div>
                                                        )}
                                                        {partner.acceleratorStrategy && (
                                                            <div className="p-3 bg-emerald-50 border-r-4 border-emerald-400">
                                                                <div className="flex items-center gap-2 text-xs font-bold text-emerald-700 uppercase mb-1"><Icons.Rocket size={12} /> ◊ê◊°◊ò◊®◊ò◊í◊ô◊ô◊™ ◊©◊™"◊§</div>
                                                                <p className="text-sm font-bold text-gray-900 leading-relaxed">{partner.acceleratorStrategy}</p>
                                                            </div>
                                                        )}

                                                        <div className="mt-4 pt-4 border-t border-gray-100 flex flex-col gap-2">
                                                            {partner.phone && <div className="flex items-center gap-2 text-sm text-gray-600"><Icons.Phone size={14} className="text-gray-400 shrink-0" /><span dir="ltr" className="font-mono tracking-wide">{partner.phone}</span></div>}
                                                            {partner.email && <div className="flex items-center gap-2 text-sm text-gray-600"><Icons.Mail size={14} className="text-gray-400 shrink-0" /><span className="truncate">{partner.email}</span></div>}
                                                            {partner.entryMechanism && <div className="flex items-center gap-2 text-sm text-gray-600"><Icons.Zap size={14} className="text-gray-400 shrink-0" /><span><span className="font-bold text-xs text-gray-400">◊û◊†◊í◊†◊ï◊ü:</span> {partner.entryMechanism}</span></div>}
                                                        </div>
                                                    </div>
                                                    <div className="mt-6">
                                                        <textarea className="w-full text-sm bg-[#F9F9F9] border-b-2 border-gray-200 focus:border-emerald-400 outline-none p-2 resize-none min-h-[60px] transition-colors placeholder-gray-400" placeholder="◊î◊¢◊®◊ï◊™..." value={partner.note || ""} onChange={(e) => updateNoteLocalUI(partner.id, e.target.value)} onBlur={(e) => saveNote(partner.id, e.target.value)} />
                                                    </div>
                                                </div>
                                                <div className="px-6 py-4 bg-gray-50 border-t border-gray-100 grid grid-cols-4 gap-2">
                                                    <ActionButton href={partner.phone ? `tel:${partner.phone}` : null} icon={Icons.Phone} label="◊ó◊ô◊ï◊í" colorClass="bg-white border border-gray-200 text-gray-700 hover:bg-gray-100" />
                                                    <ActionButton href={partner.email ? `mailto:${partner.email}` : null} icon={Icons.Mail} label="◊û◊ô◊ô◊ú" colorClass="bg-blue-50 text-blue-700 hover:bg-blue-100" />
                                                    <ActionButton href={partner.phone ? `https://wa.me/${formatForWhatsapp(partner.phone)}` : null} icon={Icons.MessageCircle} label="" colorClass="bg-green-50 text-green-600 hover:bg-green-100" />
                                                    
                                                    {/* AI Button with Popover - RESTORED ORIGINAL LOGIC */}
                                                    <div className="relative">
                                                        <ActionButton onClick={(e) => { e.stopPropagation(); setAiMenuOpenId(aiMenuOpenId === partner.id ? null : partner.id); }} icon={Icons.Sparkles} label="◊¶◊ï◊® ◊™◊ï◊õ◊ü" colorClass="bg-purple-100 text-purple-700 hover:bg-purple-200" />
                                                        {aiMenuOpenId === partner.id && (
                                                            <div className="absolute bottom-full left-0 mb-2 w-48 bg-white shadow-xl border border-purple-100 rounded-lg p-2 z-20 flex flex-col gap-1 animate-fadeIn">
                                                                <button onClick={() => handleAIAction(partner, 'pitch')} className="text-right px-3 py-2 text-sm hover:bg-purple-50 rounded text-gray-700 font-medium">‚ú® ◊§◊ô◊•' ◊û◊õ◊ô◊®◊î</button>
                                                                <button onClick={() => handleAIAction(partner, 'message')} className="text-right px-3 py-2 text-sm hover:bg-purple-50 rounded text-gray-700 font-medium">üìß ◊î◊ï◊ì◊¢◊™ ◊§◊†◊ô◊ô◊î</button>
                                                                <button onClick={() => handleAIAction(partner, 'synergy')} className="text-right px-3 py-2 text-sm hover:bg-purple-50 rounded text-gray-700 font-medium">ü§ù ◊°◊ô◊†◊®◊í◊ô◊î</button>
                                                                <div className="h-px bg-gray-100 my-1"></div>
                                                                <button onClick={() => handleAIAction(partner, 'custom')} className="text-right px-3 py-2 text-sm hover:bg-purple-50 rounded text-purple-700 font-bold">‚úçÔ∏è ◊ë◊ß◊©◊î ◊ê◊ô◊©◊ô◊™...</button>
                                                            </div>
                                                        )}
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}

                                {/* --- COMPACT VIEW (Grid) --- */}
                                {layoutMode === 'compact' && (
                                    <div className="grid grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3 md:gap-4">
                                        {filteredPartners.map((partner) => (
                                            <div 
                                                key={partner.id} 
                                                onClick={() => setViewingId(partner.id)}
                                                className="bg-white border hover:border-emerald-500 transition-all cursor-pointer shadow-sm hover:shadow-md rounded-lg p-2 flex flex-col items-center justify-center text-center aspect-square relative"
                                                style={{ borderColor: partner.contacted ? '#10B981' : undefined, backgroundColor: partner.contacted ? '#ECFDF5' : 'white' }}
                                            >
                                                {partner.contacted && <div className="absolute top-1 right-1 w-2 h-2 rounded-full bg-emerald-500"></div>}
                                                <div className="w-10 h-10 md:w-14 md:h-14 mb-2 flex items-center justify-center">
                                                    <img src={getLogoUrl(partner.domain, partner.company)} alt="" className="w-full h-full object-contain mix-blend-multiply" onError={(e) => e.target.src = `https://ui-avatars.com/api/?name=${partner.company}&background=random&color=10B981&color=fff`} />
                                                </div>
                                                <h3 className="text-[10px] md:text-xs font-bold text-gray-800 leading-tight line-clamp-2">{partner.company}</h3>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </>
                        )}
                    </div>

                    {/* AI MODAL - RESTORED ORIGINAL COMPLEX UI */}
                    {showAIModal && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm" onClick={() => setShowAIModal(false)}>
                            <div className="bg-white w-full max-w-lg shadow-2xl flex flex-col rounded-xl overflow-hidden animate-slide-up" onClick={e => e.stopPropagation()}>
                                <div className="bg-gradient-to-r from-purple-600 to-blue-600 p-6 text-white flex justify-between items-center">
                                    <div className="flex items-center gap-2">
                                        <h2 className="text-2xl font-black flex items-center gap-2"><Icons.Sparkles size={24} /> Gemini AI</h2>
                                        <span className={`text-xs px-2 py-0.5 rounded font-bold ${apiKey ? 'bg-green-400 text-green-900' : 'bg-white/20 text-white'}`}>
                                            {apiKey ? 'Live' : 'Demo'}
                                        </span>
                                    </div>
                                    <div className="flex items-center gap-2">
                                        <button onClick={() => setShowKeyInput(!showKeyInput)} className="p-2 hover:bg-white/10 rounded-full transition-colors" title="◊î◊í◊ì◊®◊™ ◊û◊§◊™◊ó"><Icons.Key size={20}/></button>
                                        <button onClick={() => setShowAIModal(false)} className="p-2 hover:bg-white/10 rounded-full transition-colors"><Icons.X size={24}/></button>
                                    </div>
                                </div>
                                
                                {showKeyInput && (
                                    <div className="bg-gray-100 p-4 border-b border-gray-200 animate-fadeIn">
                                        <p className="text-xs text-gray-500 mb-2">◊î◊ñ◊ü ◊û◊§◊™◊ó API ◊©◊ú Google Gemini ◊ú◊©◊ô◊û◊ï◊© ◊ë◊û◊ï◊ì◊ú ◊ó◊ô. ◊ú◊ú◊ê ◊û◊§◊™◊ó, ◊î◊û◊¢◊®◊õ◊™ ◊™◊§◊¢◊ú ◊ë◊û◊¶◊ë ◊î◊ì◊í◊û◊î.</p>
                                        <div className="flex gap-2">
                                            <input 
                                                type="password" 
                                                className="flex-grow p-2 text-sm border rounded outline-none focus:border-purple-500" 
                                                placeholder="◊î◊ì◊ë◊ß ◊õ◊ê◊ü ◊ê◊™ ◊û◊§◊™◊ó ◊î-API" 
                                                value={apiKey} 
                                                onChange={(e) => setApiKey(e.target.value)} 
                                            />
                                            <div className="flex gap-2">
                                                <select value={apiModel} onChange={(e) => saveModel(e.target.value)} className="flex-1 p-2 text-sm border border-gray-300 rounded outline-none focus:border-blue-500 bg-white">
                                                    {availableModels.length > 0 ? (
                                                        availableModels.map(m => <option key={m} value={m}>{m}</option>)
                                                    ) : (
                                                        <>
                                                            <option value="gemini-2.5-flash">Gemini 2.5 Flash</option>
                                                            <option value="gemini-2.0-flash-exp">Gemini 2.0 Flash Exp</option>
                                                            <option value="gemini-1.5-flash">Gemini 1.5 Flash</option>
                                                        </>
                                                    )}
                                                </select>
                                                <button onClick={() => saveApiKey(apiKey)} className="px-4 py-2 bg-blue-600 text-white text-xs font-bold rounded hover:bg-blue-700">
                                                    {availableModels.length > 0 ? '◊©◊û◊ï◊®' : '◊ò◊¢◊ü ◊û◊ï◊ì◊ú◊ô◊ù'}
                                                </button>
                                            </div>
                                        </div>
                                        <div className="flex justify-between items-center mt-2">
                                            <button onClick={testConnection} disabled={!apiKey || testConnectionStatus === 'loading'} className={`text-xs font-bold px-3 py-1 rounded border flex items-center gap-2 ${testConnectionStatus === 'success' ? 'bg-green-100 text-green-700 border-green-200' : testConnectionStatus === 'error' ? 'bg-red-100 text-red-700 border-red-200' : 'bg-white text-gray-600 border-gray-300 hover:bg-gray-50'}`}>
                                                {testConnectionStatus === 'loading' ? <Icons.RefreshCw className="animate-spin" size={12}/> : testConnectionStatus === 'success' ? <Icons.Check size={12}/> : <Icons.Zap size={12}/>}
                                                {testConnectionStatus === 'loading' ? '◊ë◊ï◊ì◊ß...' : testConnectionStatus === 'success' ? '◊ó◊ô◊ë◊ï◊® ◊™◊ß◊ô◊ü' : testConnectionStatus === 'error' ? '◊©◊í◊ô◊ê◊î' : '◊ë◊ì◊ô◊ß◊™ ◊ó◊ô◊ë◊ï◊®'}
                                            </button>
                                            <a href="https://aistudio.google.com/app/apikey" target="_blank" className="text-xs text-blue-500 underline flex items-center gap-1">◊ß◊ë◊ú ◊û◊§◊™◊ó <Icons.DownloadCloud size={12}/></a>
                                        </div>
                                        {availableModels.length > 0 && (
                                            <p className="text-[10px] text-green-600 font-medium">‚úì ◊†◊û◊¶◊ê◊ï {availableModels.length} ◊û◊ï◊ì◊ú◊ô◊ù ◊ñ◊û◊ô◊†◊ô◊ù ◊ú◊ó◊©◊ë◊ï◊ü ◊©◊ú◊ö</p>
                                        )}
                                    </div>
                                )}
                                
                                <div className="p-6 overflow-y-auto max-h-[70vh]">
                                    {/* Content Type Selector (Hidden if Custom) */}
                                    {aiContentType !== 'custom' && (
                                        <div className="flex gap-2 mb-6 bg-gray-100 p-1 rounded-lg">
                                            <button onClick={() => setAiContentType('pitch')} className={`flex-1 py-2 text-sm font-bold rounded-md transition-all ${aiContentType === 'pitch' ? 'bg-white shadow text-purple-700' : 'text-gray-500 hover:text-gray-700'}`}>Pitch</button>
                                            <button onClick={() => setAiContentType('message')} className={`flex-1 py-2 text-sm font-bold rounded-md transition-all ${aiContentType === 'message' ? 'bg-white shadow text-purple-700' : 'text-gray-500 hover:text-gray-700'}`}>Message</button>
                                            <button onClick={() => setAiContentType('synergy')} className={`flex-1 py-2 text-sm font-bold rounded-md transition-all ${aiContentType === 'synergy' ? 'bg-white shadow text-purple-700' : 'text-gray-500 hover:text-gray-700'}`}>Synergy</button>
                                        </div>
                                    )}

                                    {/* Custom Prompt Input */}
                                    {aiContentType === 'custom' && (
                                        <div className="mb-4">
                                            <label className="block text-xs font-bold text-gray-500 mb-2 uppercase">◊û◊î ◊ë◊®◊¶◊ï◊†◊ö ◊ú◊ë◊ß◊© ◊û-Gemini?</label>
                                            <textarea 
                                                className="w-full p-3 border border-purple-200 rounded-lg focus:border-purple-500 outline-none text-sm bg-purple-50 min-h-[80px]"
                                                placeholder="◊ú◊ì◊ï◊í◊û◊î: ◊™◊õ◊™◊ï◊ë ◊ú◊ô ◊û◊ô◊ô◊ú ◊î◊ô◊õ◊®◊ï◊™ ◊ß◊¶◊®..."
                                                value={customPrompt}
                                                onChange={(e) => setCustomPrompt(e.target.value)}
                                            />
                                        </div>
                                    )}

                                    <div className="bg-purple-50 border border-purple-100 rounded-lg p-4 min-h-[200px] relative">
                                        {isGeneratingAI ? (
                                            <div className="absolute inset-0 flex flex-col items-center justify-center text-purple-600 bg-white/80 z-10 rounded-lg">
                                                <div className="animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-purple-600 mb-2"></div>
                                                <span className="text-xs font-bold animate-pulse">Gemini ◊û◊†◊™◊ó ◊†◊™◊ï◊†◊ô◊ù...</span>
                                            </div>
                                        ) : aiContentResult ? (
                                            <div className="prose prose-sm prose-purple max-w-none text-gray-800 leading-relaxed" dangerouslySetInnerHTML={{ __html: marked.parse(aiContentResult) }}></div>
                                        ) : (
                                            <div className="flex flex-col items-center justify-center h-full text-gray-400 py-10">
                                                <Icons.Bot size={40} className="mb-2 opacity-20" />
                                                <p className="text-xs">
                                                    {aiContentType === 'custom' ? '◊î◊ñ◊ü ◊ë◊ß◊©◊î ◊ï◊ú◊ó◊• ◊¢◊ú ◊©◊ú◊ó' : '◊ú◊ó◊• ◊¢◊ú ◊õ◊§◊™◊ï◊® ◊î◊ô◊¶◊ô◊®◊î ◊ú◊û◊ò◊î'}
                                                </p>
                                            </div>
                                        )}
                                        
                                        {aiContentResult && !isGeneratingAI && (
                                            <div className="absolute top-2 left-2 flex gap-2">
                                                {/* RESTORED: Save Button inside result area */}
                                                <button onClick={() => saveAiToPartner(aiPartner.id, aiContentResult)} className="p-2 bg-white rounded-full shadow-sm hover:bg-green-50 text-green-600 transition-colors border border-transparent hover:border-green-200" title="◊©◊û◊ï◊® ◊ë◊õ◊®◊ò◊ô◊° ◊©◊ï◊™◊£">
                                                    <Icons.Save size={16} />
                                                </button>
                                                <button onClick={() => copyToClipboard(aiContentResult)} className="p-2 bg-white rounded-full shadow-sm hover:bg-gray-100 text-purple-600 transition-colors" title="◊î◊¢◊™◊ß">
                                                    <Icons.Copy size={16} />
                                                </button>
                                            </div>
                                        )}
                                    </div>
                                </div>

                                <div className="p-6 border-t border-gray-100 bg-gray-50 flex justify-end">
                                    <button onClick={generateAIContent} disabled={isGeneratingAI || (aiContentType === 'custom' && !customPrompt.trim())} className="px-6 py-3 bg-purple-600 hover:bg-purple-700 text-white font-bold rounded-lg shadow-md flex items-center gap-2 transition-all disabled:opacity-50 disabled:cursor-not-allowed">
                                        {aiContentType === 'custom' ? <Icons.Send size={18} /> : <Icons.Sparkles size={18} />}
                                        {isGeneratingAI ? '◊û◊ô◊ô◊¶◊® ◊™◊ï◊õ◊ü...' : (aiContentType === 'custom' ? '◊©◊ú◊ó ◊ë◊ß◊©◊î' : '◊¶◊ï◊® ◊™◊ï◊õ◊ü ◊ó◊õ◊ù')}
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* VIEWER MODAL (Used in Compact Mode) */}
                    {activePartner && (
                        <div className="fixed inset-0 z-40 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm" onClick={() => setViewingId(null)}>
                            <div className="bg-white w-full max-w-lg shadow-2xl flex flex-col rounded-xl overflow-hidden animate-slide-up relative" onClick={e => e.stopPropagation()}>
                                <div className="absolute top-2 left-2 z-20">
                                    <button onClick={() => setViewingId(null)} className="p-2 bg-black/10 hover:bg-black/20 rounded-full text-black transition-colors"><Icons.X size={20} /></button>
                                </div>
                                <button onClick={() => toggleContact(activePartner)} className={`absolute top-0 right-0 px-4 py-2 text-xs font-black uppercase tracking-wider z-10 transition-colors rounded-bl-xl ${activePartner.contacted ? 'bg-emerald-500 text-white' : 'bg-gray-200 text-gray-500 hover:bg-gray-300'}`}>
                                    {activePartner.contacted ? '◊†◊ï◊¶◊® ◊ß◊©◊® ‚úì' : '◊ú◊§◊†◊ô ◊§◊†◊ô◊ô◊î'}
                                </button>

                                <div className="p-6 pb-0 flex-grow flex flex-col max-h-[70vh] overflow-y-auto">
                                    <div className="flex items-start gap-4 mb-6 mt-8">
                                        <div className="w-20 h-20 bg-gray-50 border border-gray-100 flex items-center justify-center p-2 shrink-0 rounded-lg">
                                            <img src={getLogoUrl(activePartner.domain, activePartner.company)} alt="" className="w-full h-full object-contain mix-blend-multiply" onError={(e) => e.target.src = `https://ui-avatars.com/api/?name=${activePartner.company}&background=random&color=10B981&color=fff`} />
                                        </div>
                                        <div>
                                            <h2 className="text-3xl font-black text-[#191B1D] leading-none mb-1">{activePartner.company}</h2>
                                            <div className="flex items-center gap-1 text-sm text-gray-500 font-medium"><Icons.MapPin size={12} /> {activePartner.location || "◊ô◊©◊®◊ê◊ú"}</div>
                                            <div className="mt-2 inline-block px-2 py-0.5 bg-emerald-50 text-emerald-700 text-[10px] font-bold uppercase tracking-wide border border-emerald-100 rounded">{activePartner.category}</div>
                                        </div>
                                    </div>

                                    <div className="space-y-4">
                                        {/* --- RESTORED: AI Saved Analysis Block --- */}
                                        {activePartner.aiAnalysis && (
                                            <div className="bg-purple-50 border border-purple-100 rounded-lg p-3 text-sm mb-3">
                                                <div className="flex items-center gap-2 mb-1 text-purple-700 font-bold text-xs uppercase">
                                                    <Icons.Sparkles size={12} /> ◊™◊ï◊ë◊†◊ï◊™ AI ◊©◊û◊ï◊®◊ï◊™
                                                </div>
                                                <div className="prose prose-sm prose-purple max-w-none text-gray-700 line-clamp-4 text-xs leading-relaxed" dangerouslySetInnerHTML={{ __html: marked.parse(activePartner.aiAnalysis) }}></div>
                                            </div>
                                        )}

                                        {activePartner.valueProp && (
                                            <div>
                                                <div className="flex items-center gap-2 text-xs font-bold text-gray-400 uppercase mb-1"><Icons.Lightbulb size={12} /> ◊¢◊®◊ö ◊ê◊°◊ò◊®◊ò◊í◊ô</div>
                                                <p className="text-sm font-medium text-gray-800 leading-relaxed bg-gray-50 p-3 rounded-lg border border-gray-100">{activePartner.valueProp}</p>
                                            </div>
                                        )}
                                        {activePartner.acceleratorStrategy && (
                                            <div className="p-3 bg-emerald-50 border-r-4 border-emerald-400 rounded-l-lg">
                                                <div className="flex items-center gap-2 text-xs font-bold text-emerald-700 uppercase mb-1"><Icons.Rocket size={12} /> ◊ê◊°◊ò◊®◊ò◊í◊ô◊ô◊™ ◊©◊™"◊§</div>
                                                <p className="text-sm font-bold text-gray-900 leading-relaxed">{activePartner.acceleratorStrategy}</p>
                                            </div>
                                        )}

                                        <div className="pt-4 border-t border-gray-100 flex flex-col gap-3">
                                            {activePartner.phone && <div className="flex items-center gap-3 text-sm text-gray-700"><div className="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-gray-500"><Icons.Phone size={14} /></div><span dir="ltr" className="font-mono tracking-wide font-bold">{activePartner.phone}</span></div>}
                                            {activePartner.email && <div className="flex items-center gap-3 text-sm text-gray-700"><div className="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-gray-500"><Icons.Mail size={14} /></div><span className="truncate font-medium">{activePartner.email}</span></div>}
                                            {activePartner.entryMechanism && <div className="flex items-center gap-3 text-sm text-gray-700"><div className="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-gray-500"><Icons.Zap size={14} /></div><span><span className="font-bold text-xs text-gray-400 uppercase">◊û◊†◊í◊†◊ï◊ü:</span> {activePartner.entryMechanism}</span></div>}
                                        </div>
                                    </div>
                                    
                                    <div className="mt-6 mb-6">
                                        <textarea className="w-full text-sm bg-[#F9F9F9] border-b-2 border-gray-200 focus:border-emerald-400 outline-none p-3 resize-none min-h-[80px] transition-colors placeholder-gray-400 rounded-t-lg" placeholder="◊î◊¢◊®◊ï◊™ ◊ê◊ô◊©◊ô◊ï◊™..." value={activePartner.note || ""} onChange={(e) => updateNoteLocalUI(activePartner.id, e.target.value)} onBlur={(e) => saveNote(activePartner.id, e.target.value)} />
                                    </div>
                                </div>

                                <div className="px-6 py-4 bg-gray-50 border-t border-gray-100">
                                    <div className="grid grid-cols-4 gap-2 mb-4">
                                        <ActionButton href={activePartner.phone ? `tel:${activePartner.phone}` : null} icon={Icons.Phone} label="◊ó◊ô◊ï◊í" colorClass="bg-white border border-gray-200 text-gray-700 hover:bg-gray-100" />
                                        <ActionButton href={activePartner.email ? `mailto:${activePartner.email}` : null} icon={Icons.Mail} label="◊û◊ô◊ô◊ú" colorClass="bg-blue-50 text-blue-700 hover:bg-blue-100" />
                                        <ActionButton href={activePartner.phone ? `https://wa.me/${formatForWhatsapp(activePartner.phone)}` : null} icon={Icons.MessageCircle} label="" colorClass="bg-green-50 text-green-600 hover:bg-green-100" />
                                        
                                        {/* AI Button with Popover in Viewer - RESTORED */}
                                        <div className="relative">
                                            <ActionButton onClick={(e) => { e.stopPropagation(); setAiMenuOpenId(aiMenuOpenId === activePartner.id ? null : activePartner.id); }} icon={Icons.Sparkles} label="◊¶◊ï◊® ◊™◊ï◊õ◊ü" colorClass="bg-purple-100 text-purple-700 hover:bg-purple-200" />
                                            {aiMenuOpenId === activePartner.id && (
                                                <div className="absolute bottom-full left-0 mb-2 w-48 bg-white shadow-xl border border-purple-100 rounded-lg p-2 z-20 flex flex-col gap-1 animate-fadeIn">
                                                    <button onClick={() => handleAIAction(activePartner, 'pitch')} className="text-right px-3 py-2 text-sm hover:bg-purple-50 rounded text-gray-700 font-medium">‚ú® ◊§◊ô◊•' ◊û◊õ◊ô◊®◊î</button>
                                                    <button onClick={() => handleAIAction(activePartner, 'message')} className="text-right px-3 py-2 text-sm hover:bg-purple-50 rounded text-gray-700 font-medium">üìß ◊î◊ï◊ì◊¢◊™ ◊§◊†◊ô◊ô◊î</button>
                                                    <button onClick={() => handleAIAction(activePartner, 'synergy')} className="text-right px-3 py-2 text-sm hover:bg-purple-50 rounded text-gray-700 font-medium">ü§ù ◊°◊ô◊†◊®◊í◊ô◊î</button>
                                                    <div className="h-px bg-gray-100 my-1"></div>
                                                    <button onClick={() => handleAIAction(activePartner, 'custom')} className="text-right px-3 py-2 text-sm hover:bg-purple-50 rounded text-purple-700 font-bold">‚úçÔ∏è ◊ë◊ß◊©◊î ◊ê◊ô◊©◊ô◊™...</button>
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                    <div className="flex justify-between items-center pt-2 border-t border-gray-200/50">
                                         <button onClick={() => handleDelete(activePartner.id)} className="text-red-400 hover:text-red-600 text-xs font-bold flex items-center gap-1"><Icons.Trash2 size={14} /> ◊û◊ó◊ß</button>
                                         <button onClick={() => { setEditingId(activePartner.id); setEditForm(activePartner); setViewingId(null); setIsAddingNew(false); }} className="text-blue-500 hover:text-blue-700 text-xs font-bold flex items-center gap-1"><Icons.Edit3 size={14} /> ◊¢◊®◊ï◊ö ◊§◊®◊ò◊ô◊ù</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* STICKY BOTTOM FOOTER (Appears on scroll) */}
                    <div className={`fixed bottom-0 left-0 right-0 bg-[#111827] text-white shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] z-30 footer-slide-up ${showBottomBar ? 'footer-visible' : 'footer-hidden'}`}>
                        <div className="max-w-7xl mx-auto px-6 h-16 flex justify-between items-center">
                            <div className="flex flex-col">
                                <span className="text-sm font-bold text-emerald-500 uppercase tracking-wider font-tech">PSYCHOFLASH</span>
                                <span className="text-xs text-gray-400">◊†◊ô◊î◊ï◊ú ◊©◊ï◊™◊§◊ô◊ù</span>
                            </div>
                            
                            {/* Integrated Action Buttons */}
                            <div className="flex items-center gap-3">
                                <button 
                                    onClick={() => setIsImportModalOpen(true)}
                                    className="flex items-center gap-2 px-4 py-2 text-xs font-bold text-white border border-white/20 hover:bg-white/10 rounded transition-colors"
                                >
                                    <Icons.UploadCloud size={16} />
                                    <span className="hidden md:inline">◊ô◊ô◊ë◊ï◊ê</span>
                                </button>
                                <button 
                                    onClick={() => { setEditingId('new'); setEditForm({ company: "", category: "", subCategory: "", phone: "", email: "", location: "", valueProp: "" }); setIsAddingNew(true); }}
                                    className="flex items-center gap-2 px-4 py-2 text-xs font-bold text-white bg-emerald-600 hover:bg-emerald-700 rounded transition-colors shadow-sm"
                                >
                                    <Icons.Plus size={16} strokeWidth={3} />
                                    <span>◊î◊ï◊°◊£ ◊©◊ï◊™◊£</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    {/* IMPORT MODAL */}
                    {isImportModalOpen && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm">
                            <div className="bg-white w-full max-w-lg shadow-2xl flex flex-col rounded-lg overflow-hidden">
                                <div className="p-6 border-b border-gray-100 flex justify-between items-center bg-gray-50">
                                    <h2 className="text-xl font-black text-[#191B1D]">◊ô◊ô◊ë◊ï◊ê ◊©◊ï◊™◊§◊ô◊ù ◊û-CSV</h2>
                                    <button onClick={() => setIsImportModalOpen(false)} className="text-gray-400 hover:text-red-500 transition-colors"><Icons.X size={24} /></button>
                                </div>
                                <div className="p-6 space-y-4">
                                    <p className="text-sm text-gray-600">◊î◊ì◊ë◊ß ◊õ◊ê◊ü ◊ß◊ô◊©◊ï◊® ◊ú-Google Sheet ◊©◊§◊ï◊®◊°◊ù ◊õ-CSV (File &gt; Share &gt; Publish to web &gt; Comma-separated values).</p>
                                    <div>
                                        <label className="block text-xs font-bold text-gray-500 mb-1 uppercase">URL ◊ú-CSV</label>
                                        <input className="w-full p-3 bg-gray-50 border border-gray-200 focus:border-emerald-500 outline-none text-sm" 
                                            value={importUrl} onChange={e => setImportUrl(e.target.value)} placeholder="https://docs.google.com/..." />
                                    </div>
                                </div>
                                <div className="p-6 border-t border-gray-100 flex justify-end gap-3 bg-gray-50">
                                    <button onClick={() => setIsImportModalOpen(false)} className="px-4 py-2 font-bold text-gray-500 hover:bg-gray-200 transition-colors rounded">◊ë◊ô◊ò◊ï◊ú</button>
                                    <button onClick={handleImport} className="px-6 py-2 font-bold text-white bg-emerald-600 hover:bg-emerald-700 transition-all rounded shadow-sm flex items-center gap-2">
                                        {loading ? <Icons.RefreshCw className="animate-spin" size={16} /> : <Icons.UploadCloud size={16} />} ◊ô◊ô◊ë◊ï◊ê ◊†◊™◊ï◊†◊ô◊ù
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* EDIT/ADD MODAL */}
                    {editingId && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm">
                            <div className="bg-white w-full max-w-2xl shadow-2xl flex flex-col max-h-[90vh] rounded-lg overflow-hidden">
                                <div className="p-6 border-b border-gray-100 flex justify-between items-center bg-gray-50">
                                    <h2 className="text-2xl font-black text-[#191B1D]">{isAddingNew ? "◊î◊ï◊°◊§◊™ ◊©◊ï◊™◊£ ◊ó◊ì◊©" : "◊¢◊®◊ô◊õ◊™ ◊§◊®◊ò◊ô ◊©◊ï◊™◊£"}</h2>
                                    <button onClick={() => setEditingId(null)} className="text-gray-400 hover:text-red-500 transition-colors"><Icons.X size={24} /></button>
                                </div>
                                <div className="p-8 overflow-y-auto grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div className="col-span-2 md:col-span-1"><label className="block text-xs font-bold text-gray-400 uppercase mb-1">◊©◊ù ◊î◊ó◊ë◊®◊î</label><input className="w-full p-3 bg-gray-50 border border-gray-200 focus:border-emerald-500 outline-none font-bold" value={editForm.company || ""} onChange={e => setEditForm({...editForm, company: e.target.value})} /></div>
                                    <div className="col-span-2 md:col-span-1"><label className="block text-xs font-bold text-gray-400 uppercase mb-1">◊ì◊ï◊û◊ô◊ô◊ü (◊ú◊ï◊í◊ï)</label><input className="w-full p-3 bg-gray-50 border border-gray-200 focus:border-emerald-500 outline-none" value={editForm.domain || ""} onChange={e => setEditForm({...editForm, domain: e.target.value})} placeholder="example.com" /></div>
                                    <div className="col-span-2"><label className="block text-xs font-bold text-gray-400 uppercase mb-1">◊¢◊®◊ö ◊ê◊°◊ò◊®◊ò◊í◊ô</label><textarea className="w-full p-3 bg-gray-50 border border-gray-200 focus:border-emerald-500 outline-none" rows="2" value={editForm.valueProp || ""} onChange={e => setEditForm({...editForm, valueProp: e.target.value})} /></div>
                                    <div className="col-span-2"><label className="block text-xs font-bold text-gray-400 uppercase mb-1">◊ê◊°◊ò◊®◊ò◊í◊ô◊ô◊™ ◊©◊™"◊§</label><textarea className="w-full p-3 bg-emerald-50 border border-emerald-200 focus:border-emerald-400 outline-none font-medium" rows="2" value={editForm.acceleratorStrategy || ""} onChange={e => setEditForm({...editForm, acceleratorStrategy: e.target.value})} /></div>
                                    <div><label className="block text-xs font-bold text-gray-400 uppercase mb-1">◊ò◊ú◊§◊ï◊ü</label><input className="w-full p-3 bg-gray-50 border border-gray-200 focus:border-emerald-500 outline-none" value={editForm.phone || ""} onChange={e => setEditForm({...editForm, phone: e.target.value})} /></div>
                                    <div><label className="block text-xs font-bold text-gray-400 uppercase mb-1">◊û◊ô◊ô◊ú</label><input className="w-full p-3 bg-gray-50 border border-gray-200 focus:border-emerald-500 outline-none" value={editForm.email || ""} onChange={e => setEditForm({...editForm, email: e.target.value})} /></div>
                                    <div className="col-span-2 md:col-span-1"><label className="block text-xs font-bold text-gray-400 uppercase mb-1">◊ß◊ò◊í◊ï◊®◊ô◊î</label><input className="w-full p-3 bg-gray-50 border border-gray-200 focus:border-emerald-500 outline-none" value={editForm.category || ""} onChange={e => setEditForm({...editForm, category: e.target.value})} /></div>
                                    <div className="col-span-2 md:col-span-1"><label className="block text-xs font-bold text-gray-400 uppercase mb-1">◊™◊™ ◊ß◊ò◊í◊ï◊®◊ô◊î</label><input className="w-full p-3 bg-gray-50 border border-gray-200 focus:border-emerald-500 outline-none" value={editForm.subCategory || ""} onChange={e => setEditForm({...editForm, subCategory: e.target.value})} /></div>
                                     <div className="col-span-2 md:col-span-1"><label className="block text-xs font-bold text-gray-400 uppercase mb-1">◊û◊†◊í◊†◊ï◊ü ◊õ◊†◊ô◊°◊î</label><input className="w-full p-3 bg-gray-50 border border-gray-200 focus:border-emerald-500 outline-none" value={editForm.entryMechanism || ""} onChange={e => setEditForm({...editForm, entryMechanism: e.target.value})} /></div>
                                </div>
                                <div className="p-6 border-t border-gray-100 flex justify-end gap-4 bg-gray-50">
                                    <button onClick={() => setEditingId(null)} className="px-6 py-3 font-bold text-gray-500 hover:bg-gray-200 transition-colors rounded">◊ë◊ô◊ò◊ï◊ú</button>
                                    <button onClick={handleSave} className="px-8 py-3 font-black text-white bg-emerald-600 hover:bg-emerald-700 transition-all shadow-md flex items-center gap-2 rounded"><Icons.Save size={18} /> ◊©◊û◊ï◊® ◊©◊ô◊†◊ï◊ô◊ô◊ù</button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
