<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>מאגר שותפים אסטרטגיים | Starburst</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;700;900&display=swap');
        body { font-family: 'Heebo', sans-serif; background-color: #F1F1F1; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #F1F1F1; }
        ::-webkit-scrollbar-thumb { background: #C1C1C1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #A8A8A8; }

        .animate-spin { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        /* Toast Animation */
        @keyframes slideIn {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .toast-enter { animation: slideIn 0.3s ease-out forwards; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, doc, setDoc, updateDoc, deleteDoc, onSnapshot, serverTimestamp, query, orderBy, writeBatch } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // --- Firebase Config ---
        const firebaseConfig = JSON.parse(__firebase_config);
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'starburst-partners';

        const React = window.React;
        const { useState, useEffect, useMemo } = React;

        // --- Icons ---
        const Icons = {
            Search: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>,
            Filter: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon></svg>,
            Phone: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg>,
            Mail: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>,
            MessageCircle: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path></svg>,
            MapPin: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>,
            Lightbulb: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="9" y1="18" x2="15" y2="18"></line><line x1="10" y1="22" x2="14" y2="22"></line><path d="M15.09 14c.18-.98.65-1.74 1.41-2.5A4.65 4.65 0 0 0 16 8c0-4.42-3.58-8-8-8s-8 3.58-8 8c0 2.08.73 3.97 1.92 5.48.1.13.2.25.3.37.66.77 1.12 1.53 1.28 2.5H15.09z"></path></svg>,
            Rocket: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z"></path><path d="M12 15l-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z"></path><path d="M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0"></path><path d="M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5"></path></svg>,
            Edit3: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M12 20h9"></path><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path></svg>,
            Trash2: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>,
            Plus: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>,
            Save: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg>,
            X: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>,
            RefreshCw: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg>,
            Check: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="20 6 9 17 4 12"></polyline></svg>,
            UploadCloud: ({size=20, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242"/><path d="M12 12v9"/><path d="m16 16-4-4-4 4"/></svg>
        };

        // --- Data ---
        const initialPartnersData = [
            { id: "static_1", category: "ביטחון (Tier-1)", subCategory: "חדשנות עמוקה", company: "אלביט מערכות", entryMechanism: "Incubit Ventures", valueProp: "טכנולוגיות Deep Tech אזרחיות.", acceleratorStrategy: "Deal Flow Source: צייד מיזמי Pre-seed.", insight: "מתאים ל-Early Stage. מימון ממשלתי.", phone: "077-2940000", email: "corp.int.market@elbitsystems.com", location: "חיפה", domain: "elbitsystems.com" },
            { id: "static_2", category: "ביטחון (Tier-1)", subCategory: "פיתוח משותף", company: "רפאל", entryMechanism: "Co-Development", valueProp: "יכולות תוכנה/AI משלימות.", acceleratorStrategy: "Challenge Management: ניהול אתגר חדשנות.", insight: "מחפשים Battle Proven.", phone: "073-3354714", email: "intl-mkt@rafael.co.il", location: "חיפה", domain: "rafael.co.il" },
            { id: "static_3", category: "ביטחון וחלל", subCategory: "חלל ולוויינות", company: "תעשייה אווירית (IAI)", entryMechanism: "IAI Catalyst", valueProp: "חדשנות משבשת בחלל ולוויינים.", acceleratorStrategy: "Innovation Lab Partner: מעבדות ו-POC.", insight: "לבדוק סוגיות בעלות על ה-IP.", phone: "03-9353111", email: "catalyst@iai.co.il", location: "לוד", domain: "iai.co.il" },
            { id: "static_4", category: "תעשייה וייצור", subCategory: "מיגון וחומרים", company: "פלסן סאסא", entryMechanism: "Open Innovation", valueProp: "חומרים מרוכבים קלים וחזקים.", acceleratorStrategy: "Design Partner: שותף תעשייתי.", insight: "מחפשים בשלות לייצור סדרתי.", phone: "04-6809000", email: "info@plasan.com", location: "סאסא", domain: "plasan.com" },
            { id: "static_5", category: "רכב ותחבורה", subCategory: "אוטונומיה", company: "GM ישראל", entryMechanism: "מרכז מו\"פ", valueProp: "הטמעת חיישנים צבאיים (LiDAR).", acceleratorStrategy: "Tech Scouting: הסבה לרכב.", insight: "דגש על הפרדת IP.", phone: "09-9720600", email: "", location: "הרצליה", domain: "gm.com" },
            { id: "static_6", category: "תשתיות ומים", subCategory: "ניהול מים", company: "מקורות", entryMechanism: "WaTech", valueProp: "ניטור עילי של תשתיות מים.", acceleratorStrategy: "Validation Partner: אתרי Beta Site.", insight: "קריטי לתיקוף גלובלי.", phone: "03-6230555", email: "waTech@mekorot.co.il", location: "תל אביב", domain: "mekorot.co.il" },
        ];

        const THEME = {
            black: '#191B1D',
            dark: '#17191A',
            yellow: '#FFC700',
            blue: '#1F63C7',
            bg: '#F1F1F1',
            gray: '#E3E3E3',
            white: '#FFFFFF'
        };

        // --- CSV Parser ---
        const parseCSV = (str) => {
            const arr = [];
            let quote = false;
            for (let row = 0, col = 0, c = 0; c < str.length; c++) {
                let cc = str[c], nc = str[c+1];
                arr[row] = arr[row] || [];
                arr[row][col] = arr[row][col] || '';
                if (cc == '"' && quote && nc == '"') { arr[row][col] += cc; ++c; continue; }
                if (cc == '"') { quote = !quote; continue; }
                if (cc == ',' && !quote) { ++col; continue; }
                if (cc == '\r' && nc == '\n' && !quote) { ++row; col = 0; ++c; continue; }
                if (cc == '\n' && !quote) { ++row; col = 0; continue; }
                if (cc == '\r' && !quote) { ++row; col = 0; continue; }
                arr[row][col] += cc;
            }
            return arr;
        };

        // --- Toast Notification Component ---
        const Toast = ({ type, message, onClose }) => {
            if (!message) return null;
            return (
                <div className={`fixed bottom-4 left-4 z-50 px-6 py-4 rounded-lg shadow-xl flex items-center gap-3 toast-enter transform transition-all duration-300 ${type === 'success' ? 'bg-[#191B1D] text-white border-r-4 border-[#FFC700]' : 'bg-red-600 text-white border-r-4 border-white'}`}>
                    {type === 'success' ? <Icons.Check size={20} className="text-[#FFC700]" /> : <Icons.AlertTriangle size={20} />}
                    <span className="font-bold text-sm">{message}</span>
                    <button onClick={onClose} className="mr-4 text-white/50 hover:text-white"><Icons.X size={16} /></button>
                </div>
            );
        };

        // --- App Component ---
        const App = () => {
            const [partners, setPartners] = useState(initialPartnersData);
            const [loading, setLoading] = useState(true);
            const [user, setUser] = useState(null);
            const [searchTerm, setSearchTerm] = useState("");
            const [selectedCategory, setSelectedCategory] = useState("הכל");
            const [editingId, setEditingId] = useState(null);
            const [editForm, setEditForm] = useState({});
            const [isAddingNew, setIsAddingNew] = useState(false);
            const [isImportModalOpen, setIsImportModalOpen] = useState(false);
            const [importUrl, setImportUrl] = useState("https://docs.google.com/spreadsheets/d/e/2PACX-1vQSkgkIvL4h1048RW_HiR-qnodnGw_XoVJZ9x_6sdgkMdTg9FN4ggtcW681YwM2jGSj8YoBAKxFP7Gw/pub?output=csv");
            const [notification, setNotification] = useState(null); // { type: 'success'|'error', message: '' }

            const showNotification = (type, message) => {
                setNotification({ type, message });
                setTimeout(() => setNotification(null), 3500);
            };

            // Auth
            useEffect(() => {
                const initAuth = async () => {
                    try {
                        if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                            await signInWithCustomToken(auth, __initial_auth_token);
                        } else {
                            await signInAnonymously(auth);
                        }
                    } catch (e) {
                        console.error("Auth failed, using fallback data only", e);
                        setLoading(false);
                    }
                };
                initAuth();
                return onAuthStateChanged(auth, (u) => setUser(u));
            }, []);

            // Sync with DB
            useEffect(() => {
                if (!user) return;

                const q = collection(db, 'artifacts', appId, 'public', 'data', 'partners');

                const unsubscribe = onSnapshot(q, (snapshot) => {
                    if (snapshot.empty) {
                        // Seed if empty
                        initialPartnersData.forEach(p => {
                             const { id, ...data } = p;
                             setDoc(doc(q), { ...data, contacted: false, note: "", createdAt: serverTimestamp() });
                        });
                    } else {
                        let docs = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                        docs.sort((a, b) => (a.company || "").localeCompare(b.company || ""));
                        setPartners(docs);
                        setLoading(false);
                    }
                }, (err) => {
                    console.error("Sync error:", err);
                    setLoading(false);
                });

                return () => unsubscribe();
            }, [user]);

            // Handlers
            const toggleContact = async (partner) => {
                if (!user) return;
                try {
                    const ref = doc(db, 'artifacts', appId, 'public', 'data', 'partners', partner.id);
                    await updateDoc(ref, { contacted: !partner.contacted });
                    showNotification('success', partner.contacted ? 'סטטוס עודכן: לא נוצר קשר' : 'סטטוס עודכן: נוצר קשר');
                } catch(e) { console.error(e); showNotification('error', 'שגיאה בעדכון סטטוס'); }
            };

            const handleDelete = async (id) => {
                if (!user) {
                    alert("אנא המתן לטעינת המערכת");
                    return;
                }
                if (!window.confirm("האם למחוק שותף זה לצמיתות?")) return;
                
                try {
                    await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'partners', id));
                    setEditingId(null);
                    showNotification('success', 'השותף נמחק בהצלחה');
                } catch (e) {
                    console.error("Delete failed:", e);
                    showNotification('error', 'שגיאה במחיקה');
                }
            };

            const handleSave = async () => {
                if (!user) return;
                const colRef = collection(db, 'artifacts', appId, 'public', 'data', 'partners');
                const data = { ...editForm };
                
                try {
                    if (isAddingNew) {
                        await setDoc(doc(colRef), { ...data, contacted: false, note: "", createdAt: serverTimestamp() });
                        showNotification('success', 'שותף חדש נוסף בהצלחה');
                    } else {
                        await updateDoc(doc(colRef, editingId), data);
                        showNotification('success', 'הפרטים נשמרו בהצלחה');
                    }
                    setEditingId(null);
                    setEditForm({});
                    setIsAddingNew(false);
                } catch(e) {
                    console.error("Save failed:", e);
                    showNotification('error', 'שגיאה בשמירה');
                }
            };

            const saveNote = async (id, text) => {
                if (!user) return;
                try {
                    await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'partners', id), { note: text });
                } catch(e) { console.error(e); }
            };

            // Import Logic
            const handleImport = async () => {
                if (!user) {
                    showNotification('error', 'אנא התחבר למערכת תחילה');
                    return;
                }
                setLoading(true);
                try {
                    const proxyUrl = "https://api.allorigins.win/raw?url=" + encodeURIComponent(importUrl);
                    const response = await fetch(proxyUrl);
                    if (!response.ok) throw new Error("Network response was not ok");
                    const csvText = await response.text();
                    const rawData = parseCSV(csvText);
                    
                    if (rawData.length === 0) throw new Error("קובץ ריק");

                    // Header identification logic
                    const headerRowIndex = rawData.findIndex(row => row.some(cell => 
                        cell.includes('שם החברה') || cell.includes('Company') || cell.includes('חברה')
                    ));

                    if (headerRowIndex === -1) throw new Error("לא נמצאה שורת כותרת תקינה ב-CSV");

                    const headers = rawData[headerRowIndex].map(h => h.trim());
                    
                    const keyMap = {
                        "קטגוריה": "category", "תת": "subCategory", "שם החברה": "company", "חברה": "company", 
                        "מנגנון": "entryMechanism", "ערך": "valueProp", "אסטרטגיית": "acceleratorStrategy", 
                        "תובנה": "insight", "טלפון": "phone", "מייל": "email", "מיקום": "location", "דומיין": "domain"
                    };

                    const columnIndices = {};
                    headers.forEach((header, index) => {
                        const foundKey = Object.keys(keyMap).find(k => header.includes(k));
                        if (foundKey) columnIndices[keyMap[foundKey]] = index;
                    });

                    let importCount = 0;
                    const batchSize = 500; // Not using real batch here, just simple loop for simplicity with setDoc
                    // For robust imports we should use batch, but iterating setDoc is fine for small lists
                    
                    for (let i = headerRowIndex + 1; i < rawData.length; i++) {
                        const row = rawData[i];
                        if (row.length <= 1 && (!row[0] || row[0].trim() === "")) continue;

                        const rowData = {};
                        let hasCompany = false;
                        Object.keys(columnIndices).forEach(key => {
                            const idx = columnIndices[key];
                            const val = row[idx] ? row[idx].trim() : "";
                            rowData[key] = val;
                            if (key === 'company' && val) hasCompany = true;
                        });

                        if (hasCompany) {
                            // Generate a predictable ID or let firestore handle it. Let's generate new doc for import.
                            // To prevent duplicates, we could query first, but for simplicity we just add.
                            const colRef = collection(db, 'artifacts', appId, 'public', 'data', 'partners');
                            await setDoc(doc(colRef), { ...rowData, contacted: false, note: "", createdAt: serverTimestamp() });
                            importCount++;
                        }
                    }
            
                    showNotification('success', `יובאו ${importCount} שותפים בהצלחה!`);
                    setIsImportModalOpen(false);
                } catch (e) {
                    console.error(e);
                    showNotification('error', 'שגיאה בייבוא הנתונים: ' + e.message);
                } finally {
                    setLoading(false);
                }
            };

            // Helpers
            const getLogoUrl = (domain, company) => domain ? `https://logo.clearbit.com/${domain}` : `https://ui-avatars.com/api/?name=${encodeURIComponent(company || "?")}&background=random&color=fff`;
            const formatForWhatsapp = (phone) => {
                if (!phone) return "";
                const clean = phone.replace(/\D/g, '');
                return clean.startsWith('0') ? `972${clean.substring(1)}` : `972${clean}`;
            };

            // Filter
            const categories = useMemo(() => ["הכל", ...new Set(partners.map(p => p.category).filter(Boolean))], [partners]);
            const filteredPartners = useMemo(() => {
                return partners.filter(p => {
                    const term = searchTerm.toLowerCase();
                    const matchSearch = (p.company||"").toLowerCase().includes(term) || (p.valueProp||"").toLowerCase().includes(term);
                    const matchCat = selectedCategory === "הכל" || p.category === selectedCategory;
                    return matchSearch && matchCat;
                });
            }, [partners, searchTerm, selectedCategory]);

            // Sub-components
            const ActionButton = ({ href, icon: Icon, label, colorClass }) => {
                if (!href) return null;
                return (
                    <a href={href} target={href.startsWith('http') ? "_blank" : undefined} className={`flex items-center justify-center gap-2 py-2 px-4 rounded font-bold text-sm transition-all duration-200 flex-1 shadow-sm ${colorClass}`}>
                        <Icon size={16} /> <span>{label}</span>
                    </a>
                );
            };

            return (
                <div className="min-h-screen flex flex-col" style={{ backgroundColor: THEME.bg }}>
                    {/* Toast */}
                    {notification && <Toast type={notification.type} message={notification.message} onClose={() => setNotification(null)} />}

                    <style>{`
                        @import url('https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;700;900&display=swap');
                        body { font-family: 'Heebo', sans-serif; }
                    `}</style>

                    {/* HERO */}
                    <header className="text-white relative overflow-hidden" style={{ backgroundColor: THEME.dark }}>
                         <div className="absolute right-[-10%] top-[-50%] w-[50%] h-[200%] opacity-5 pointer-events-none" style={{ background: `radial-gradient(circle, ${THEME.yellow} 0%, transparent 70%)` }}></div>
                        <div className="max-w-7xl mx-auto px-6 py-16 relative z-10">
                            <div className="flex flex-col md:flex-row justify-between items-end gap-8">
                                <div>
                                    <div className="flex items-center gap-3 mb-4">
                                        <span className="text-xs font-bold px-3 py-1 rounded uppercase tracking-widest text-black" style={{ backgroundColor: THEME.yellow }}>STARBURST PARTNERS</span>
                                    </div>
                                    <h1 className="text-6xl md:text-8xl font-black uppercase leading-[0.85] tracking-tighter mb-4">מאגר<br/>השותפים</h1>
                                    <p className="text-xl text-gray-400 font-light max-w-lg">ניהול קשרים אסטרטגיים בזמן אמת.</p>
                                </div>
                                <div className="flex gap-4">
                                    <button onClick={() => setIsImportModalOpen(true)} className="group flex items-center gap-3 px-6 py-4 text-lg font-bold text-white border border-white/30 hover:bg-white/10 transition-all rounded-sm">
                                        <Icons.UploadCloud size={24} /> ייבוא מ-CSV
                                    </button>
                                    <button onClick={() => { setEditingId('new'); setEditForm({ company: "", category: "", subCategory: "", phone: "", email: "", location: "", valueProp: "" }); setIsAddingNew(true); }} className="group flex items-center gap-3 px-8 py-4 text-lg font-bold text-black transition-all hover:scale-105 shadow-lg" style={{ backgroundColor: THEME.yellow }}>
                                        <Icons.Plus size={24} strokeWidth={3} /> הוסף שותף
                                    </button>
                                </div>
                            </div>
                        </div>
                    </header>

                    {/* FILTERS */}
                    <div className="sticky top-0 z-30 shadow-md backdrop-blur-md bg-white/90 border-b border-gray-200">
                        <div className="max-w-7xl mx-auto px-6 py-4 flex flex-col md:flex-row gap-4 items-center justify-between">
                            <div className="flex items-center gap-4 w-full md:w-auto flex-1">
                                <div className="relative flex-1 max-w-md">
                                    <input type="text" placeholder="חיפוש..." className="w-full pl-4 pr-10 py-3 bg-gray-100 border border-transparent focus:bg-white focus:border-blue-600 outline-none transition-all rounded-none font-medium" value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} />
                                    <Icons.Search size={18} className="absolute top-3.5 right-3 text-gray-500" />
                                </div>
                                <div className="relative w-48">
                                    <select className="w-full pl-4 pr-10 py-3 bg-gray-100 border border-transparent focus:bg-white focus:border-blue-600 outline-none transition-all appearance-none rounded-none font-bold text-sm" value={selectedCategory} onChange={(e) => setSelectedCategory(e.target.value)}>
                                        {categories.map(cat => <option key={cat} value={cat}>{cat}</option>)}
                                    </select>
                                    <Icons.Filter size={16} className="absolute top-4 right-3 text-gray-500 pointer-events-none" />
                                </div>
                            </div>
                            <div className="flex items-center gap-2 text-sm font-bold text-gray-500 bg-gray-100 px-4 py-2 rounded-none">
                                {loading ? <Icons.RefreshCw size={16} className="animate-spin" /> : <Icons.Check size={16} className="text-green-500" />}
                                <span>{filteredPartners.length} שותפים</span>
                            </div>
                        </div>
                    </div>

                    {/* GRID */}
                    <div className="max-w-7xl mx-auto px-6 py-12 flex-grow">
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                            {filteredPartners.map((partner) => (
                                <div key={partner.id} className="bg-white border-2 border-transparent hover:border-blue-600 transition-all duration-300 group flex flex-col relative shadow-sm hover:shadow-xl" style={{ borderColor: partner.contacted ? '#48BB78' : 'transparent' }}>
                                    <button onClick={() => toggleContact(partner)} className={`absolute top-0 right-0 px-3 py-1 text-xs font-black uppercase tracking-wider z-10 transition-colors ${partner.contacted ? 'bg-green-500 text-white' : 'bg-gray-200 text-gray-500 hover:bg-gray-300'}`}>
                                        {partner.contacted ? 'נוצר קשר ✓' : 'לפני פנייה'}
                                    </button>
                                    <button onClick={() => { setEditingId(partner.id); setEditForm(partner); setIsAddingNew(false); }} className="absolute top-0 left-0 p-2 text-gray-300 hover:text-blue-600 opacity-0 group-hover:opacity-100 transition-opacity z-10">
                                        <Icons.Edit3 size={18} />
                                    </button>

                                    <div className="p-6 flex-grow">
                                        <div className="flex items-start gap-4 mb-6 mt-4">
                                            <div className="w-16 h-16 bg-gray-50 border border-gray-100 flex items-center justify-center p-2">
                                                <img src={getLogoUrl(partner.domain, partner.company)} alt="" className="w-full h-full object-contain mix-blend-multiply" onError={(e) => e.target.src = `https://ui-avatars.com/api/?name=${partner.company}`} />
                                            </div>
                                            <div>
                                                <h2 className="text-2xl font-black text-[#191B1D] leading-none mb-1">{partner.company}</h2>
                                                <div className="flex items-center gap-1 text-sm text-gray-500 font-medium"><Icons.MapPin size={12} /> {partner.location || "ישראל"}</div>
                                                <div className="mt-2 inline-block px-2 py-0.5 bg-blue-50 text-blue-700 text-[10px] font-bold uppercase tracking-wide border border-blue-100">{partner.category}</div>
                                            </div>
                                        </div>

                                        <div className="space-y-4">
                                            {partner.valueProp && (
                                                <div>
                                                    <div className="flex items-center gap-2 text-xs font-bold text-gray-400 uppercase mb-1"><Icons.Lightbulb size={12} /> ערך אסטרטגי</div>
                                                    <p className="text-sm font-medium text-gray-800 leading-relaxed">{partner.valueProp}</p>
                                                </div>
                                            )}
                                            {partner.acceleratorStrategy && (
                                                <div className="p-3 bg-yellow-50 border-r-4 border-yellow-400">
                                                    <div className="flex items-center gap-2 text-xs font-bold text-yellow-700 uppercase mb-1"><Icons.Rocket size={12} /> אסטרטגיית שת"פ</div>
                                                    <p className="text-sm font-bold text-gray-900 leading-relaxed">{partner.acceleratorStrategy}</p>
                                                </div>
                                            )}
                                        </div>
                                        <div className="mt-6">
                                            <textarea className="w-full text-sm bg-[#F9F9F9] border-b-2 border-gray-200 focus:border-yellow-400 outline-none p-2 resize-none min-h-[60px] transition-colors placeholder-gray-400" placeholder="הערות..." defaultValue={partner.note} onBlur={(e) => saveNote(partner.id, e.target.value)} />
                                        </div>
                                    </div>
                                    <div className="px-6 py-4 bg-gray-50 border-t border-gray-100 grid grid-cols-3 gap-3">
                                        <ActionButton href={partner.phone ? `tel:${partner.phone}` : null} icon={Icons.Phone} label="חיוג" colorClass="bg-white border border-gray-200 text-gray-700 hover:bg-gray-100" />
                                        <ActionButton href={partner.email ? `mailto:${partner.email}` : null} icon={Icons.Mail} label="מייל" colorClass="bg-blue-50 text-blue-700 hover:bg-blue-100" />
                                        <ActionButton href={partner.phone ? `https://wa.me/${formatForWhatsapp(partner.phone)}` : null} icon={Icons.MessageCircle} label="" colorClass="bg-green-50 text-green-600 hover:bg-green-100" />
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* IMPORT MODAL */}
                    {isImportModalOpen && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm">
                            <div className="bg-white w-full max-w-lg shadow-2xl flex flex-col rounded-lg overflow-hidden">
                                <div className="p-6 border-b border-gray-100 flex justify-between items-center bg-gray-50">
                                    <h2 className="text-xl font-black text-[#191B1D]">ייבוא שותפים מ-CSV</h2>
                                    <button onClick={() => setIsImportModalOpen(false)} className="text-gray-400 hover:text-red-500 transition-colors"><Icons.X size={24} /></button>
                                </div>
                                <div className="p-6 space-y-4">
                                    <p className="text-sm text-gray-600">הדבק כאן קישור ל-Google Sheet שפורסם כ-CSV (File &gt; Share &gt; Publish to web &gt; Comma-separated values).</p>
                                    <div>
                                        <label className="block text-xs font-bold text-gray-500 mb-1 uppercase">URL ל-CSV</label>
                                        <input className="w-full p-3 bg-gray-50 border border-gray-200 focus:border-blue-500 outline-none text-sm" 
                                            value={importUrl} onChange={e => setImportUrl(e.target.value)} placeholder="https://docs.google.com/..." />
                                    </div>
                                </div>
                                <div className="p-6 border-t border-gray-100 flex justify-end gap-3 bg-gray-50">
                                    <button onClick={() => setIsImportModalOpen(false)} className="px-4 py-2 font-bold text-gray-500 hover:bg-gray-200 transition-colors rounded">ביטול</button>
                                    <button onClick={handleImport} className="px-6 py-2 font-bold text-white bg-blue-600 hover:bg-blue-700 transition-all rounded shadow-sm flex items-center gap-2">
                                        {loading ? <Icons.RefreshCw className="animate-spin" size={16} /> : <Icons.UploadCloud size={16} />} ייבוא נתונים
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* EDIT/ADD MODAL */}
                    {editingId && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm">
                            <div className="bg-white w-full max-w-2xl shadow-2xl flex flex-col max-h-[90vh] rounded-lg overflow-hidden">
                                <div className="p-6 border-b border-gray-100 flex justify-between items-center bg-gray-50">
                                    <h2 className="text-2xl font-black text-[#191B1D]">{isAddingNew ? "הוספת שותף חדש" : "עריכת פרטי שותף"}</h2>
                                    <button onClick={() => setEditingId(null)} className="text-gray-400 hover:text-red-500 transition-colors"><Icons.X size={24} /></button>
                                </div>
                                <div className="p-8 overflow-y-auto grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div className="col-span-2 md:col-span-1"><label className="block text-xs font-bold text-gray-400 uppercase mb-1">שם החברה</label><input className="w-full p-3 bg-gray-50 border border-gray-200 focus:border-blue-500 outline-none font-bold" value={editForm.company || ""} onChange={e => setEditForm({...editForm, company: e.target.value})} /></div>
                                    <div className="col-span-2 md:col-span-1"><label className="block text-xs font-bold text-gray-400 uppercase mb-1">דומיין (לוגו)</label><input className="w-full p-3 bg-gray-50 border border-gray-200 focus:border-blue-500 outline-none" value={editForm.domain || ""} onChange={e => setEditForm({...editForm, domain: e.target.value})} placeholder="example.com" /></div>
                                    <div className="col-span-2"><label className="block text-xs font-bold text-gray-400 uppercase mb-1">ערך אסטרטגי</label><textarea className="w-full p-3 bg-gray-50 border border-gray-200 focus:border-blue-500 outline-none" rows="2" value={editForm.valueProp || ""} onChange={e => setEditForm({...editForm, valueProp: e.target.value})} /></div>
                                    <div className="col-span-2"><label className="block text-xs font-bold text-gray-400 uppercase mb-1">אסטרטגיית שת"פ</label><textarea className="w-full p-3 bg-yellow-50 border border-yellow-200 focus:border-yellow-400 outline-none font-medium" rows="2" value={editForm.acceleratorStrategy || ""} onChange={e => setEditForm({...editForm, acceleratorStrategy: e.target.value})} /></div>
                                    <div><label className="block text-xs font-bold text-gray-400 uppercase mb-1">טלפון</label><input className="w-full p-3 bg-gray-50 border border-gray-200 focus:border-blue-500 outline-none" value={editForm.phone || ""} onChange={e => setEditForm({...editForm, phone: e.target.value})} /></div>
                                    <div><label className="block text-xs font-bold text-gray-400 uppercase mb-1">מייל</label><input className="w-full p-3 bg-gray-50 border border-gray-200 focus:border-blue-500 outline-none" value={editForm.email || ""} onChange={e => setEditForm({...editForm, email: e.target.value})} /></div>
                                    <div className="col-span-2 md:col-span-1"><label className="block text-xs font-bold text-gray-400 uppercase mb-1">קטגוריה</label><input className="w-full p-3 bg-gray-50 border border-gray-200 focus:border-blue-500 outline-none" value={editForm.category || ""} onChange={e => setEditForm({...editForm, category: e.target.value})} /></div>
                                    <div className="col-span-2 md:col-span-1"><label className="block text-xs font-bold text-gray-400 uppercase mb-1">מנגנון כניסה</label><input className="w-full p-3 bg-gray-50 border border-gray-200 focus:border-blue-500 outline-none" value={editForm.entryMechanism || ""} onChange={e => setEditForm({...editForm, entryMechanism: e.target.value})} /></div>
                                </div>
                                <div className="p-6 border-t border-gray-100 flex justify-between items-center bg-gray-50">
                                    {!isAddingNew && <button onClick={() => handleDelete(editingId)} className="text-red-500 hover:text-red-700 text-sm font-bold flex items-center gap-2 px-4 py-2"><Icons.Trash2 size={16} /> מחק</button>}
                                    <div className="flex gap-4">
                                        <button onClick={() => setEditingId(null)} className="px-6 py-3 font-bold text-gray-500 hover:bg-gray-200 transition-colors rounded">ביטול</button>
                                        <button onClick={handleSave} className="px-8 py-3 font-black text-black bg-[#FFC700] hover:bg-[#E5B300] transition-all shadow-md flex items-center gap-2 rounded"><Icons.Save size={18} /> שמור שינויים</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
